<HTML>
<HEAD>

<TITLE>NetRexx Tutorial - Additional Instructions</TITLE>
<table cellpadding=7>
<tr valign=top>
<td><img src="NetRexx.gif" width=64 height=64 alt=""></td>
<td>
<font size=6 color=darkblue><strong>The NetRexx Tutorial
<br>
<IMG SRC="l_red.gif"> -  Additional Instructions </font></strong>
</td></tr></table>
<TITLE>NetRexx Tutorial - Additional Instructions</TITLE>
</HEAD>
<BODY>
<P><HR><P>


<H1> Additional Instructions </H1>
<P>
<A NAME="IDX404"></A>


<H2> <IMG SRC="yellowball.gif"> Introduction. </H2>
<P>
<EM>
We collect here all those instructions that have
we have not so far had the pleasure to comment on or show, because they did not
fall into any of the categories we looked at. This does not
imply that they are any less important.
</EM>

</P>


<H2> <IMG SRC="yellowball.gif"> Arrays </H2>



<H3> <IMG SRC="yellowball.gif"> The xarray function package </H3>

<P>
<A NAME="IDX405"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: dump                                                |<STRONG>27</STRONG>
| -- purpose.....: dump array's contents                               |<STRONG>28</STRONG>
| --                                                                   |<STRONG>29</STRONG>
|   method dump(a=rexx[],name) public static                           |<STRONG>30</STRONG>
|     len = a.length                                                   |<STRONG>31</STRONG>
|     fil = name'(dim='len')'                                          |<STRONG>32</STRONG>
|     fil = fil.left(10)                                               |<STRONG>33</STRONG>
|     oval  = 'DUMMY'                                                  |<STRONG>34</STRONG>
|     skip  = 0                                                        |<STRONG>35</STRONG>
|     dosay = 0                                                        |<STRONG>36</STRONG>
|     loop i = 0 to len-1                                              |<STRONG>37</STRONG>
|       if a[i] = NULL                                                 |<STRONG>38</STRONG>
|         then val = 'NULL'                                            |<STRONG>39</STRONG>
|         else val = a[i]                                              |<STRONG>40</STRONG>
|       dosay = 0                                                      |<STRONG>41</STRONG>
|       if val = oval                                                  |<STRONG>42</STRONG>
|         then skip = skip+1                                           |<STRONG>43</STRONG>
|         else dosay = 1                                               |<STRONG>44</STRONG>
|       if i = len-1 then dosay = 1                                    |<STRONG>45</STRONG>
|       if dosay then                                                  |<STRONG>46</STRONG>
|         do                                                           |<STRONG>47</STRONG>
|           if skip &#62; 0 then                                           |<STRONG>48</STRONG>
|             do                                                       |<STRONG>49</STRONG>
|               if (i = len - 1) then skip = skip - 1                  |<STRONG>50</STRONG>
|               if skip &#62; 0 then say fil '(...' skip 'lines not display|<STRONG>51</STRONG>
|               if i &#60;&#62; len-1 then say fil '['i-1']' oval              |<STRONG>52</STRONG>
|               skip = 0                                               |<STRONG>53</STRONG>
|             end                                                      |<STRONG>54</STRONG>
|           say fil '['i']' val                                        |<STRONG>55</STRONG>
|         end                                                          |<STRONG>56</STRONG>
|       oval = val                                                     |<STRONG>57</STRONG>
|       fil = ' '.copies(10)                                           |<STRONG>58</STRONG>
|     end                                                              |<STRONG>59</STRONG>
|     say                                                              |<STRONG>60</STRONG>
|                                                                      |<STRONG>61</STRONG>
+----------------------------------------------------------------------+
                                                 xarray.nrx(Method:dump)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/xarray.nrx">Download the complete source for the xarray.nrx library </A>
 
</PRE>

<P>
<A NAME="IDX406"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: copy                                                |<STRONG>51</STRONG>
| -- purpose.....: copy array's contents                               |<STRONG>52</STRONG>
| --                                                                   |<STRONG>53</STRONG>
|   method copy(a=rexx[],b=rexx[]) public static                       |<STRONG>54</STRONG>
|     System.arraycopy(a,0,b,0,a.length)                               |<STRONG>55</STRONG>
|                                                                      |<STRONG>56</STRONG>
+----------------------------------------------------------------------+
                                                 xarray.nrx(Method:copy)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/xarray.nrx">Download the complete source for the xarray.nrx library </A>
 
</PRE>



<H3> <IMG SRC="yellowball.gif"> Code example no.1 </H3>
<P>
Let's use the routines we've built in the <STRONG>xarray</STRONG>
library.

</P>
<P>
<A NAME="IDX407"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- arrex1.nrx                                                        |<STRONG>01</STRONG>
| -- Simple example of array handling                                  |<STRONG>02</STRONG>
| --                                                                   |<STRONG>03</STRONG>
|                                                                      |<STRONG>04</STRONG>
| a = rexx[10]            -- define array dimentions                   |<STRONG>05</STRONG>
| b = rexx[12]            --                                           |<STRONG>06</STRONG>
|                                                                      |<STRONG>07</STRONG>
| xarray.init(a,")       -- initialize array a                        |<STRONG>08</STRONG>
| a[0] = 'line1'          -- with some values                          |<STRONG>09</STRONG>
| a[1] = 'line2'                                                       |<STRONG>10</STRONG>
|                                                                      |<STRONG>11</STRONG>
| xarray.dump(a,'a')      -- look at a and b                           |<STRONG>12</STRONG>
| xarray.dump(b,'b')                                                   |<STRONG>13</STRONG>
|                                                                      |<STRONG>14</STRONG>
| xarray.copy(a,b)        -- copy a to b                               |<STRONG>15</STRONG>
|                                                                      |<STRONG>16</STRONG>
| b[0] = 'XXXXXXXXXXXX'                                                |<STRONG>17</STRONG>
| xarray.dump(a,'a')      -- look at a and b                           |<STRONG>18</STRONG>
| xarray.dump(b,'b')                                                   |<STRONG>19</STRONG>
|                                                                      |<STRONG>20</STRONG>
| exit 0                                                               |<STRONG>21</STRONG>
+----------------------------------------------------------------------+
                                                              arrex1.nrx
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../examples/arrex1.nrx">Download the  source for the arrex1.nrx example </A>
 
</PRE>



<H3> <IMG SRC="yellowball.gif"> Non NetRexx Arrays </H3>
<P>
<A NAME="IDX408"></A>
<A NAME="IDX409"></A>

</P>
<P>
In this small example we consider how to deal with non NetRexx (Rexx)
arrays.

</P>
<P>
<A NAME="IDX410"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- tstring.nrx                                                       |<STRONG>01</STRONG>
| -- small example of String[] handling                                |<STRONG>02</STRONG>
| --                                                                   |<STRONG>03</STRONG>
|                                                                      |<STRONG>04</STRONG>
| class tstring1 public                                                |<STRONG>05</STRONG>
|                                                                      |<STRONG>06</STRONG>
|   method t1() returns String[] public static                         |<STRONG>07</STRONG>
|     s = String[2]                                                    |<STRONG>08</STRONG>
|     s[0] = 'Francesca'                                               |<STRONG>09</STRONG>
|     s[1] = 'Elisabetta'                                              |<STRONG>10</STRONG>
|     say s.length                                                     |<STRONG>11</STRONG>
|     return s                                                         |<STRONG>12</STRONG>
|                                                                      |<STRONG>13</STRONG>
|   method main(args=String[]) public static                           |<STRONG>14</STRONG>
|     arg = rexx(args)                                                 |<STRONG>15</STRONG>
|     parse arg .                                                      |<STRONG>16</STRONG>
|                                                                      |<STRONG>17</STRONG>
|     in = String[100]                                                 |<STRONG>18</STRONG>
|     in = t1()                                                        |<STRONG>19</STRONG>
|     loop i = 0 to in.length - 1                                      |<STRONG>20</STRONG>
|       say in[i]                                                      |<STRONG>21</STRONG>
|     end                                                              |<STRONG>22</STRONG>
|                                                                      |<STRONG>23</STRONG>
|     line = rexx(in)                                                  |<STRONG>24</STRONG>
|     say line                                                         |<STRONG>25</STRONG>
|     exit 0                                                           |<STRONG>26</STRONG>
+----------------------------------------------------------------------+
                                                            tstring1.nrx
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../examples/tstring1.nrx">Download the  source for the tstring1.nrx example </A>
 
</PRE>



<H2> <IMG SRC="yellowball.gif"> Byte Arrays conversion methods </H2>
<P>
Byte array handling is a bit tedious. This is the motivation of
the methods described in <STRONG>xarray</STRONG>.

</P>
<P>
In a byte array, infact, the quantities are, from the NetRexx
point of view, stored as signed integer, so it will be:

</P>

<PRE>
 
  a[0] = '01'       1
  a[1] = '81'    -127
  a[2] = 'FE'      -2
  a[3] = '41'      65
 
</PRE>

<P>
In order to convert it to HEX, for example, you'll need to
follow the procedure:

<PRE>
 
  ch = rexx a[2]   -&#62; -2
  ch = ch.d2x(2)   -&#62; FE
 
</PRE>

<P>
The methods we've developed are:

<PRE>
 
 xarray.ba2x(array,start,length)
 xarray.ba2c(array,start,length)
 xarray.ba2d(array,start,length)
 xarray.bagrepx(array,HEX,start)
 
</PRE>

<P>
Using the <STRONG>a[]</STRONG> array, we can look at some simple
examples, like:

</P>

<PRE>
 
                              will give:
                              ----------
xarray.ba2x(a,1,2)         -&#62; 81FE

xarray.ba2c(a,3,1)         -&#62; A

xarray.bagrepx(a,'81FE',0) -&#62; 2

 
</PRE>

<P>
<STRONG>REMARK:</STRONG> those methods are SLOW! I should probably find a
faster way to implement them. Suggestions are welcome!

</P>



<H3> <IMG SRC="yellowball.gif"> Some sample routines </H3>
<P>
<A NAME="IDX411"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: ba2x                                                |<STRONG>57</STRONG>
| -- purpose.....: ByteArray to HEX                                    |<STRONG>58</STRONG>
| --                                                                   |<STRONG>59</STRONG>
|   method ba2x(a=byte[],start=rexx,length=rexx) public static         |<STRONG>60</STRONG>
|     ostr = ''                                                        |<STRONG>61</STRONG>
|     loop i = start to start + length - 1                             |<STRONG>62</STRONG>
|       ch = rexx a[i]                                                 |<STRONG>63</STRONG>
|       xch = ch.d2x(2)                                                |<STRONG>64</STRONG>
|       ostr = ostr||xch                                               |<STRONG>65</STRONG>
|     end                                                              |<STRONG>66</STRONG>
|     return ostr                                                      |<STRONG>67</STRONG>
|                                                                      |<STRONG>68</STRONG>
+----------------------------------------------------------------------+
                                                 xarray.nrx(Method:ba2x)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/xarray.nrx">Download the complete source for the xarray.nrx library </A>
 
</PRE>

<P>
The following method will search an ARRAY for an HEX quantity, which
you write in the form (for example):

<PRE>
 
  'A0FF'
 
</PRE>

<P>
the methods returns the value of the FIRST occurrence (from the start)
of the HEX string.

</P>
<P>
<A NAME="IDX412"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: bagrepx                                             |<STRONG>89</STRONG>
| -- purpose.....: grep an HEX qty in a ByteArray                      |<STRONG>90</STRONG>
| --                                                                   |<STRONG>91</STRONG>
|   method bagrepx(a=byte[],search=rexx,start=rexx) public static      |<STRONG>92</STRONG>
|     l = search.length()                                              |<STRONG>93</STRONG>
|     b = byte[l/2]                                                    |<STRONG>94</STRONG>
|                                                                      |<STRONG>95</STRONG>
|     -- convert the HEX string                                        |<STRONG>96</STRONG>
|     -- to decimal                                                    |<STRONG>97</STRONG>
|     --                                                               |<STRONG>98</STRONG>
|     list = search                                                    |<STRONG>99</STRONG>
|     i = 0                                                            |<STRONG>00</STRONG>
|     loop while list &#60;&#62; ''                                            |<STRONG>01</STRONG>
|       parse list nb +2 list                                          |<STRONG>02</STRONG>
|       b[i] = nb.x2d(2)                                               |<STRONG>03</STRONG>
|       i = i+1                                                        |<STRONG>04</STRONG>
|     end                                                              |<STRONG>05</STRONG>
|                                                                      |<STRONG>06</STRONG>
|     lend = a.length - 1                                              |<STRONG>07</STRONG>
|     match = 0                                                        |<STRONG>08</STRONG>
|     loop i = start to lend                                           |<STRONG>09</STRONG>
|       if a[i] == b[0] then                                           |<STRONG>10</STRONG>
|         do                                                           |<STRONG>11</STRONG>
|           match = 1                                                  |<STRONG>12</STRONG>
|           loop j = 1 to b.length - 1                                 |<STRONG>13</STRONG>
|             if b[j] &#60;&#62; a[i+j] then                                   |<STRONG>14</STRONG>
|               do                                                     |<STRONG>15</STRONG>
|                 match = 0                                            |<STRONG>16</STRONG>
|                 leave                                                |<STRONG>17</STRONG>
|               end                                                    |<STRONG>18</STRONG>
|           end                                                        |<STRONG>19</STRONG>
|           if match then leave                                        |<STRONG>20</STRONG>
|         end                                                          |<STRONG>21</STRONG>
|     end                                                              |<STRONG>22</STRONG>
|     if match                                                         |<STRONG>23</STRONG>
|       then return i                                                  |<STRONG>24</STRONG>
|       else return -1                                                 |<STRONG>25</STRONG>
|                                                                      |<STRONG>26</STRONG>
+----------------------------------------------------------------------+
                                              xarray.nrx(Method:bagrepx)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/xarray.nrx">Download the complete source for the xarray.nrx library </A>
 
</PRE>



<H3> <IMG SRC="yellowball.gif"> Example: a JPEG info grabber </H3>
<P>
<A NAME="IDX413"></A>
<A NAME="IDX414"></A>
<A NAME="IDX415"></A>

</P>
<P>
To apply the methods described above, let's write a small
program that finds the size, in pixels, of a JPEG picture
file.

</P>
<P>
Without going into details, we say that a JPEG (Joint Photographic Experts Group) file is a binary
file. The header looks like:

</P>

<PRE>
 
  Marker: FF D8
        : FF E0 00 10
      ID: 4A 46 49 46 (== JFIF)
 
</PRE>

<P>
JFIF stands for JPEG File Interchange Format. The marker we look at is
'FFC0' that contains the image size.

</P>

<P>
<A NAME="IDX416"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- grab info on JPEG file                                            |<STRONG>01</STRONG>
| --                                                                   |<STRONG>02</STRONG>
| parse arg fn .                                                       |<STRONG>03</STRONG>
| if fn = '' then                                                      |<STRONG>04</STRONG>
|   do                                                                 |<STRONG>05</STRONG>
|     say 'usage: java jpginfo FILEID'                                 |<STRONG>06</STRONG>
|     exit 1                                                           |<STRONG>07</STRONG>
|   end                                                                |<STRONG>08</STRONG>
|                                                                      |<STRONG>09</STRONG>
| -- read input file;                                                  |<STRONG>10</STRONG>
| -- if ERROR, abort                                                   |<STRONG>11</STRONG>
| --                                                                   |<STRONG>12</STRONG>
| fid = xfile(fn)                                                      |<STRONG>13</STRONG>
| rc = fid.readbuf()                                                   |<STRONG>14</STRONG>
| if rc &#60;&#62; 0 then                                                      |<STRONG>15</STRONG>
|   do                                                                 |<STRONG>16</STRONG>
|     say 'Error reading file "'fn'".'                                 |<STRONG>17</STRONG>
|     exit 2                                                           |<STRONG>18</STRONG>
|   end                                                                |<STRONG>19</STRONG>
| buf = fid.buffer                                                     |<STRONG>20</STRONG>
|                                                                      |<STRONG>21</STRONG>
| -- check for signature                                               |<STRONG>22</STRONG>
| --                                                                   |<STRONG>23</STRONG>
| si = xarray.ba2c(buf,6,4)                                            |<STRONG>24</STRONG>
| if si &#60;&#62; 'JFIF' then                                                 |<STRONG>25</STRONG>
|   do                                                                 |<STRONG>26</STRONG>
|     say 'Unable to find signature.'                                  |<STRONG>27</STRONG>
|     exit 3                                                           |<STRONG>28</STRONG>
|   end                                                                |<STRONG>29</STRONG>
|                                                                      |<STRONG>30</STRONG>
| -- find the marker                                                   |<STRONG>31</STRONG>
| --                                                                   |<STRONG>32</STRONG>
| p = xarray.bagrepx(buf,'FFC0',0)                                     |<STRONG>33</STRONG>
| if p = -1 then                                                       |<STRONG>34</STRONG>
|   do                                                                 |<STRONG>35</STRONG>
|     say 'Could not locate "FFC0" mark.'                              |<STRONG>36</STRONG>
|     exit 4                                                           |<STRONG>37</STRONG>
|   end                                                                |<STRONG>38</STRONG>
|                                                                      |<STRONG>39</STRONG>
| -- all OK,                                                           |<STRONG>40</STRONG>
| -- get the info                                                      |<STRONG>41</STRONG>
| --                                                                   |<STRONG>42</STRONG>
| w  = xarray.ba2d(buf,p+7,2)                                          |<STRONG>43</STRONG>
| h  = xarray.ba2d(buf,p+9,2)                                          |<STRONG>44</STRONG>
| say h'*'w                                                            |<STRONG>45</STRONG>
|                                                                      |<STRONG>46</STRONG>
| exit 0                                                               |<STRONG>47</STRONG>
+----------------------------------------------------------------------+
                                                             jpginfo.nrx
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../examples/jpginfo.nrx">Download the  source for the jpginfo.nrx example </A>
 
</PRE>



<H3> <IMG SRC="yellowball.gif"> Additional Readings. </H3>


<PRE>
 
<EM>For the graphics formats, look at:</EM>

<A href="http://wsspinfo.cern.ch/faq/graphics/fileformats-faq/part3">http://wsspinfo.cern.ch/faq/graphics/fileformats-faq/part3</A>

<EM>The Independent JPEG Group archive on ftp.uu.net contains an on-line
copy of the JFIF specification and additional JPEG information. Look at:</EM>

ftp://ftp.uu.net/graphics/jpeg/jfif.ps.gz
ftp://ftp.uu.net/graphics/jpeg/jpeg.documents.gz

 
</PRE>



<H2> <IMG SRC="yellowball.gif"> The xsys.time() function. </H2>
<P>
<A NAME="IDX417"></A>
We use the <STRONG>xsys.time()</STRONG> function to get the local time in the
format "hh:mm:ss" (hours, minutes, seconds).
The <STRONG>xsys.time()</STRONG> function can be called with arguments that
change the output format a little.
 
The complete list of arguments is:

<PRE>
 
  N  -   hh:mm:ss          - Normal (the default);
  C  -   hh:mmxx           - Civil
  L  -   hh:mm:ss.uuuuu    - Long
 
  H  -   hh                - Hours
  M  -   mmmm              - Minutes
                             (minutes since midnight)
  S  -   ssss              - Seconds
                             (seconds since midnight)
 
 
</PRE>

<P>
The best way to see all those options is to write a small
program that shows all of them.
The small <STRONG>timeexa1</STRONG> program does it.

</P>
<P>
<A NAME="IDX418"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- simple test of the xsys.time()                                    |<STRONG>01</STRONG>
| -- function                                                          |<STRONG>02</STRONG>
|                                                                      |<STRONG>03</STRONG>
| list = 'N C H M S Z'                                                 |<STRONG>04</STRONG>
| loop while list &#60;&#62; ''                                                |<STRONG>05</STRONG>
|   parse list kind list                                               |<STRONG>06</STRONG>
|   say xsys.time(kind)                                                |<STRONG>07</STRONG>
| end                                                                  |<STRONG>08</STRONG>
| exit 0                                                               |<STRONG>09</STRONG>
+----------------------------------------------------------------------+
                                                            timeexa1.nrx
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../examples/timeexa1.nrx">Download the  source for the timeexa1.nrx example </A>
 
</PRE>

<P>
Here is what you get if you run it. The output will of course
depends on the time at which you run it.

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="80%" BGCOLOR="707070">
<tr><td>
<PRE>
....................................................................
rsl3pm1 (68) <STRONG> eti1</STRONG>
Option "N" returns:  17:46:30
Option "H" returns:  17
Option "M" returns:  1066
Option "S" returns:  63990
Option "L" returns:  17:46:30.121
Option "C" returns:  5:46pm
Option "Z" returns:  GMT
rsl3pm1 (69) <STRONG></STRONG>
....................................................................

</td></tr>
</table>
 
</PRE>

<P>
 


<H2> <IMG SRC="yellowball.gif"> Time your programs with a timer class. </H2>
<P>
<A NAME="IDX419"></A>
<A NAME="IDX420"></A>
<A NAME="IDX421"></A>


<H3> <IMG SRC="yellowball.gif"> The problem </H3>

<P>
You usually need to
measure time intervals in your programs. In this
way you can measure how long an operation takes to perform.

</P>
<P>
You can use the Java <STRONG>System</STRONG> class
<STRONG>System.currenttimemillis()</STRONG>time method, and measure
the time differences yourself.

</P>

<PRE>
 
  now = System.currenttimemillis  
 
</PRE>

<P>
This method returns the current time in milliseconds GMT since
the EPOCH (00:00:00 UTC, January 1, 1970).

</P>
<P>
The numbers returned are BIG

</P>


<H3> <IMG SRC="yellowball.gif"> The idea. </H3>

<P>
We define then a <STRONG>timer</STRONG> class.
 
The two basic instructions are:

<PRE>
 

(...)
-- define a timer
timer1 = <STRONG>timer()</STRONG>
(...)

(...)
-- get the elapsed time
elapsed = <STRONG>timer1.elapsed()</STRONG>
   (to get the elapsed time since the LAST reset)
(...)

(...)
-- reset the timer
zero = <STRONG>timer1.reset()</STRONG>
   (to reset the timer)
(...)

 
</PRE>



<H3> <IMG SRC="yellowball.gif"> The timer class implementation </H3>

<P>
<A NAME="IDX422"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: elapsed                                            |<STRONG>46</STRONG>
| -- purpose.....: returns the elapsed time in SSSS.MMM               |<STRONG>47</STRONG>
| --                                                                  |<STRONG>48</STRONG>
|   method elapsed() public returns Rexx                              |<STRONG>49</STRONG>
|     current = System.currenttimemillis                              |<STRONG>50</STRONG>
|     numeric digits 16                                               |<STRONG>51</STRONG>
|     delta = current - start                                         |<STRONG>52</STRONG>
|     delta = delta/1000                                              |<STRONG>53</STRONG>
|     numeric digits 9                                                |<STRONG>54</STRONG>
|     delta = delta.format(NULL,3)                                    |<STRONG>55</STRONG>
|     return delta                                                    |<STRONG>56</STRONG>
|                                                                     |<STRONG>57</STRONG>
+----------------------------------------------------------------------+
                                                xsys.nrx(Method:elapsed)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/xsys.nrx">Download the complete source for the xsys.nrx library </A>
 
</PRE>

<P>
<A NAME="IDX423"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: reset                                              |<STRONG>29</STRONG>
| -- purpose.....: reset the timer; returns '0.000' seconds           |<STRONG>30</STRONG>
| --                                                                  |<STRONG>31</STRONG>
|   method reset() public returns Rexx                                |<STRONG>32</STRONG>
|     start = System.currenttimemillis                                |<STRONG>33</STRONG>
|     return '0.000'                                                  |<STRONG>34</STRONG>
|                                                                     |<STRONG>35</STRONG>
+----------------------------------------------------------------------+
                                                  xsys.nrx(Method:reset)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/xsys.nrx">Download the complete source for the xsys.nrx library </A>
 
</PRE>



<H2> <IMG SRC="yellowball.gif"> The date() function. </H2>
<P>
<A NAME="IDX424"></A>

<PRE>
 
*
* WARNING:
*   REXX's date function
*   will be implemented in xsys v2.000.
*
 
</PRE>

<P>
Use the <STRONG>date()</STRONG> instruction to get the
current local date in the format 'dd Mmm yyyy'.
 
As we saw for <STRONG>time()</STRONG> also  <STRONG>date()</STRONG> has many
options.
 
These are:
 

<PRE>
 
 N  -  dd Mmm yyyy      - Normal;
 
 E  -  dd/mm/yy         - European;
 U  -  mm/dd/yy         - USA;
 O  -  yy/mm/dd         - Ordered;
 
 C  -  ddddd            - days (so far)
                          in this century;
 D  -  ddd              - say (so far)
                          in this year;
 
 S  -  yyyymmdd         - Standard;
 
</PRE>

<P>
 
As for <STRONG>time()</STRONG>, we do the same exercise also for
<STRONG>date()</STRONG>.
I simply write the results, since the program is easily
modified from <STRONG>eti1</STRONG>.
 

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="80%" BGCOLOR="707070">
<tr><td>
<PRE>
....................................................................
rsl3pm1 (75) <STRONG>eda1</STRONG>
Option "N" returns:  () <STRONG>5 Feb 1995</STRONG>
 
Option "E" returns:  () <STRONG>05/02/95</STRONG>
Option "U" returns:  () <STRONG>02/05/95</STRONG>
Option "O" returns:  () <STRONG>95/02/05</STRONG>
 
Option "S" returns:  () <STRONG>19950205</STRONG>
Option "C" returns:  () <STRONG>34734</STRONG>
Option "D" returns:  () <STRONG>36</STRONG>
 
Option "M" returns:  () <STRONG>February</STRONG>
Option "W" returns:  () <STRONG>Sunday</STRONG>
 
rsl3pm1 (76) <STRONG></STRONG>
....................................................................
                                                            eda1.out
</td></tr>
</table>
 
</PRE>

<P>
 
 


<H2> <IMG SRC="yellowball.gif"> The xdate() function </H2>
<P>
<A NAME="IDX425"></A>
<A NAME="IDX426"></A>
<A NAME="IDX427"></A>

</P>
<P>
The NetRexx <STRONG>xsys</STRONG> function <STRONG>xdate</STRONG> (for eXtended
DATE) is <STRONG>the</STRONG> function for performing all imaginable
operations related to date. The original code was
developed for VM/CMS by Bernard Antoine of CERN/CN
in IBM/370 assembler code. The version I describe
here is a porting of that code done by its original
author in pure NetRexx.

</P>
<P>
This code is totally platform independent, and is available
on the WWW NetRexx Tutorial page (in the xsys library).
 
<STRONG>xdate</STRONG> can be used in two ways:

<PRE>
 
 
 - to display a certain date
   in a given output format
   (ex: <STRONG>xsys.xdate('TODAY','U')</STRONG> )
 
 - to perform a conversion of a date
   from one format to another
   (ex: <STRONG>xsys.xdate('E','01/12/95','J')</STRONG> )
 
 
</PRE>

<P>
 
The valid input formats are:

<PRE>
 
  D,ddd             - number of days since the beginning of the year
                      format;

  J,[yy]yyddd       - julian format;

  S,[yy]yymmdd      - sorted format;

  O,[[yy]yy/]mm/dd  - ordered format;

  E,dd/mm[/[yy]yy]  - European format;

  U,mm/dd[/[yy]yy]  - USA format;

  B,nnnn            - number of days since  the January 1st, 0001
                      format;

  C,nnnn            - number of days since the beginning of the
                      century format;

  K,[yy]yyww        - format according to ISO 2015 &#38; 2711;

  I,nnnn            - incremental format;

  I,+nnnn

  I,-nnnn
 
</PRE>

<P>
 
Output_format may be any single character accepted by the
REXX DATE function:
 

<PRE>
 
  O   to obtain the date in ordered form, i.e. yy/mm/dd

  U   to obtain the date in USA form, i.e. mm/dd/yy

  E   to obtain the date in European form, i.e. dd/mm/yy

  S   to obtain the date in 'sorted' form, i.e. yyyymmdd

  J   to obtain the date in julian form, i.e. yyddd

  B   to obtain the number of days since  the January 1st, 0001

  C   to obtain the number of days since the beginning of
      the century

  D   to obtain the number of days since the beginning of the year

  M   to obtain the month name

  W   to obtain the weekday name
 
</PRE>

<P>
 
In addition, XDATE also accepts:
<A NAME="IDX428"></A>
 

<PRE>
 
  I   to obtain the date in increment form Ñ i.e. relative to today

  K   to return the id of the current  week, in the form yyyyww
      (according to ISO 2015 &#38; 2711)

  L   a logical value to tell if the year is a leap one or not

  N   to obtain the month num (instead of name as in M) in the range 1Ð12

  X   to obtain the weekday num (instead of name as in W) in the range 1Ð7
 
</PRE>

<P>
 


<H3> <IMG SRC="yellowball.gif"> small xdate example </H3>
<P>
Here is a small example of the <STRONG>xdate</STRONG>
function (look at the comments to see what the program really does):

</P>
<P>
<A NAME="IDX429"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- xdt0                                                              |<STRONG>01</STRONG>
| -- Exercise a bit the XDATE functions                                |<STRONG>02</STRONG>
| --                                                                   |<STRONG>03</STRONG>
|                                                                      |<STRONG>04</STRONG>
| -- Get today's date                                                  |<STRONG>05</STRONG>
| --                                                                   |<STRONG>06</STRONG>
| say xmisc.xdate('TODAY')                                             |<STRONG>07</STRONG>
|                                                                      |<STRONG>08</STRONG>
| -- Get next monday's                                                 |<STRONG>09</STRONG>
| --                                                                   |<STRONG>10</STRONG>
| say xmisc.xdate('NEXT','MONDAY')                                     |<STRONG>11</STRONG>
|                                                                      |<STRONG>12</STRONG>
| -- convert 31 DEC 1994 in from European to Julian Format             |<STRONG>13</STRONG>
| --                                                                   |<STRONG>14</STRONG>
| say xmisc.xdate('E','31/12/94','J')                                  |<STRONG>15</STRONG>
|                                                                      |<STRONG>16</STRONG>
| -- find out which weekday I was born                                 |<STRONG>17</STRONG>
| --                                                                   |<STRONG>18</STRONG>
| say xmisc.xdate('E','28/09/67','W')                                  |<STRONG>19</STRONG>
|                                                                      |<STRONG>20</STRONG>
| -- find out which date will be in 1000 days                          |<STRONG>21</STRONG>
| --                                                                   |<STRONG>22</STRONG>
| say xmisc.xdate('I',1000,'E')                                        |<STRONG>23</STRONG>
|                                                                      |<STRONG>24</STRONG>
| -- find out how many days I have                                     |<STRONG>25</STRONG>
| --                                                                   |<STRONG>26</STRONG>
| say xmisc.xdate('TODAY','C') - xmisc.xdate('E','28/09/67','C')       |<STRONG>27</STRONG>
|                                                                      |<STRONG>28</STRONG>
| -- find out when I'll have 20000 days                                |<STRONG>29</STRONG>
| --                                                                   |<STRONG>30</STRONG>
| nn = xmisc.xdate('TODAY','C') - xmisc.xdate('E','28/09/67','C')      |<STRONG>31</STRONG>
| nn = 20000 - nn                                                      |<STRONG>32</STRONG>
| say xmisc.xdate('I', nn , 'S')                                       |<STRONG>33</STRONG>
|                                                                      |<STRONG>34</STRONG>
| say 'Today is:' xmisc.date('E')                                      |<STRONG>35</STRONG>
| say '         ' xmisc.date('W')                                      |<STRONG>36</STRONG>
|                                                                      |<STRONG>37</STRONG>
| exit                                                                 |<STRONG>38</STRONG>
+----------------------------------------------------------------------+
                                                                xdt0.nrx
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../examples/xdt0.nrx">Download the  source for the xdt0.nrx example </A>
 
</PRE>

<P>
<STRONG>NOTEs:</STRONG>
 
And here is the output:

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="80%" BGCOLOR="707070">
<tr><td>
<PRE>
....................................................................
rsl3pm1 (39) <STRONG>java xdt0</STRONG>
5 Feb 1995
94365
Thursday
01/11/97
9992
20220701
rsl3pm1 (40) <STRONG></STRONG>
....................................................................
                                                            xdt0.out
</td></tr>
</table>
 
</PRE>

<P>
If you are wondering about all the possible output formats,
here is a program for showing them:
 
<A NAME="IDX430"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- xdt1.nrx                                                          |<STRONG>01</STRONG>
| -- exercise all XDATE formats                                        |<STRONG>02</STRONG>
| --                                                                   |<STRONG>03</STRONG>
|                                                                      |<STRONG>04</STRONG>
| kind = 'O U S J B C D M W I K L N X'                                 |<STRONG>05</STRONG>
| loop while kind &#60;&#62; ''                                                |<STRONG>06</STRONG>
|    parse kind item kind                                              |<STRONG>07</STRONG>
|    date = xmisc.xdate('TODAY',item)                                  |<STRONG>08</STRONG>
|    say 'Format "'item'" is: 'date'.'                                 |<STRONG>09</STRONG>
| end                                                                  |<STRONG>10</STRONG>
| exit 0                                                               |<STRONG>11</STRONG>
+----------------------------------------------------------------------+
                                                                xdt1.nrx
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../examples/xdt1.nrx">Download the  source for the xdt1.nrx example </A>
 
</PRE>

<P>
And this is what you will get if you run the
program:

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="80%" BGCOLOR="707070">
<tr><td>
<PRE>
....................................................................
rsl3pm1 (43) <STRONG>java xdt1</STRONG>
Format "O" is: 95/02/05.
Format "U" is: 02/05/95.
Format "S" is: 19950205.
Format "J" is: 95036.
Format "B" is: 728328.
Format "C" is: 34734.
Format "D" is: 36.
Format "M" is: February.
Format "W" is: Sunday.
Format "I" is: 0.
Format "K" is: 199505.
Format "L" is: 0.
Format "N" is: 2.
Format "X" is: 7.
rsl3pm1 (44) <STRONG></STRONG>
....................................................................
                                                            xdt1.out
</td></tr>
</table>
 
</PRE>

<P>
 


<H2> <IMG SRC="yellowball.gif"> The xsys.sleep() function. </H2>
<P>
<A NAME="IDX431"></A>
<A NAME="IDX432"></A>
<A NAME="IDX433"></A>

</P>
<P>
It is often usefull to sleep() N seconds.
The easyest way is to call the Thread.sleep() function:

</P>

<PRE>
 
-- just pause MILLISEC
Thread.sleep(MILLISEC)
 
</PRE>

<P>
where MILLISEC is the time you want to sleep (expressed in
milliseconds).

</P>


<H2> <IMG SRC="yellowball.gif"> Complex Data Structures </H2>
<P>
<A NAME="IDX434"></A>

</P>
<P>
As we saw in the previous chapters, there is ONLY one native data
type in NetRexx, and that is the <STRONG>string</STRONG>.
NetRexx considers even the numbers as strings.
 
Indeed, you can build yourself data types, the most
useful one being the following:
 

<PRE>
 
 list (string)       (stem)
   =
 'ITEM1' ,     ---&#62;  value[ITEM1]
 'ITEM2' ,     ---&#62;  value[ITEM2]
 'ITEM3' ,     ---&#62;  value[ITEM3]
 (...)
 'ITEMN'       ---&#62;  value[ITEMN]
 
 
</PRE>

<P>
We have a string that holds a list of items, which are
in their turn pointers for an array (or for many arrays)
holding the data for that particular array.
 


<H3> <IMG SRC="yellowball.gif"> A case study: printer accounting </H3>
<P>
 
We want to see how this data structure works in practice.
An accounting program may be the best way.
 
Supposing we are producing some accounting
records whenever an user prints something on a printer,
an accounting record is generated. The format of these
records would be the following:
 

<PRE>
 
  date userid nodeid printerid no_of_pages
 
</PRE>

<P>
 
<EM>where:</EM>

</P>

<PRE>
 
  date.......: the date in the format YYMMDDhhmmss;
  userid.....: the user identifier;
  nodeid.....: the node he used to print from;
  printerid..: the name of the printer;
  no_of_pages: how many pages he printed.
 
 
</PRE>

<P>
 
Here is a small (usually this kind of files is MUCH bigger)
example of such a file:
 

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+------------------------------------------------------------------+
| 110195110233 mount slil308.cern.ch prt21 200                     |
| 110195120000 marchesi rsl3pm1.cern.ch prt56 82                   |
| 120195120340 marchesi rsl3pm1.cern.ch prt56 20                   |
| 120195123030 mount hpl3sn1.cern.ch prt11 1                       |
| 120195123400 clare shift31.cern.ch prt11 25                      |
+------------------------------------------------------------------+
                                                       printer.CARDS
</td></tr>
</table>
 
</PRE>

<P>
 
The structure of our accounting program will be:

<PRE>
 
  READ the accounting file
  REDUCE the data
  POST processing (if any)
  DISPLAY results
 
</PRE>

<P>
 


<H3> <IMG SRC="yellowball.gif"> First Version </H3>
<P>
In our first version for this program, we simply want to see
how many pages a user has printed.
 
The following program (called <STRONG>pracc</STRONG>) will do it.
 
In the first portion of the code, we check for the
input argument and read a file. We will not go into the
details: what we do is simply get the lines of the
accounting cards into the array <STRONG>infid.line[]</STRONG>.

</P>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| /* prologue                                                          |01
|  */                                                                  |02
| parse arg fid .                                                      |03
| if fid = '-h' then                                                   |04
|   do                                                                 |05
|     say 'usage pacc &#60;fid&#62;'                                           |06
|     exit 3                                                           |07
|   end                                                                |08
| if fid = '' then fid = 'printer.CARDS'                               |09
| if \xfile.fexist(fid) then                                           |10
|   do                                                                 |11
|     say 'file "'fid'" does not exist.'                               |12
|     exit 4                                                           |13
|   end                                                                |14
| infid = xfile(fid)                                                   |15
| rc = infid.read()                                                    |16
| if rc &#60;&#62; 0 then                                                      |17
|   do                                                                 |18
|     say 'RC:' rc 'from READ.'                                        |19
|     exit 3                                                           |20
|   end                                                                |21
|                                                                      |22
+----------------------------------------------------------------------+
                                                               pracc.nrx
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../examples/pracc.nrx">Download the  source for the pracc.nrx example </A>
 
</PRE>

<P>
We are now ready to analyse our data ,i.e. the lines contained in
the stem <STRONG>CARDS</STRONG>.
 
As you can see, we loop over the accounting cards Ñ from the first
over to the last one. We parse the information contained in a card
<STRONG>line 28</STRONG>. We check if the user contained in the card is
known. If not, we add the user to the 'known users'
list (<STRONG>user_list</STRONG>), and just for double security,
we initialise the number of pages printed to 0
(<STRONG>line 32</STRONG>).
 
We then add the pages for this accounting card to the total for
the user.

</P>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| /* Data Collection                                                   |23
|  */                                                                  |24
| user_list = ''                                                       |25
| pages_printed_by = 0                                                 |26
| loop i = 1 to infid.lines                                            |27
|   parse infid.line[i] date user node printer pages                   |28
|   if user_list.wordpos(user) = 0 then                                |29
|     do                                                               |30
|       user_list = user_list user                                     |31
|     end                                                              |32
|   pages_printed_by[user] = pages_printed_by[user] + pages            |33
| end                                                                  |34
|                                                                      |35
+----------------------------------------------------------------------+
                                                               pracc.nrx
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../examples/pracc.nrx">Download the  source for the pracc.nrx example </A>
 
</PRE>

<P>
If we take the data we showed in the
example <STRONG>printer.CARDS</STRONG>, this is what we get
at the end of the code:

</P>

<PRE>
 
  user_list = 'mount marchesi clare'
 
  pages_printed_by.mount = 201
  pages_printed_by.marchesi = 102
  pages_printed_by.clare = 25
 
</PRE>

<P>
Now that the raw data is reduced in this format, we can do whatever
we want over it: order by name of the user the <STRONG>user_list</STRONG>,
order by number of printed pages, etc.
 
We can even do nothing, such as here:

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+------------------------------------------------------------------+
| /* post process                                                  |37
|  */                                                              |38
+------------------------------------------------------------------+
</td></tr>
</table>
 
</PRE>

<P>
 
Now we can display the 'reduced' data. This is just a loop over
the users, and each time we will display the user and the
pages printed.

</P>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| /* display                                                           |36
|  */                                                                  |37
| list = user_list                                                     |38
| loop for list.words()                                                |39
|   parse list item list                                               |40
|   say item.left(12,'.')':' pages_printed_by[item].right(7)           |41
| end                                                                  |42
|                                                                      |43
| /* end                                                               |44
|  */                                                                  |45
| exit 0                                                               |46
+----------------------------------------------------------------------+
                                                               pracc.nrx
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../examples/pracc.nrx">Download the  source for the pracc.nrx example </A>
 
</PRE>

<P>
 
That is all. Here is what you get from the program itself:

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="80%" BGCOLOR="707070">
<tr><td>
<PRE>
....................................................................
rsl3pm1 (23) <STRONG>java pracc2</STRONG>
mount.......:     201
marchesi....:     102
clare.......:      25
rsl3pm1 (24) <STRONG></STRONG>
....................................................................
                                                            pacc.out
</td></tr>
</table>
 
</PRE>



<H3> <IMG SRC="yellowball.gif"> A second version </H3>
<P>
Suppose that now your manager asks you to have the report
not only for users, but ALSO for printers. The modifications
are quite trivial you simply need to create a new
list for the printers, and clone the logic you used so far:
 

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| /* prologue                                                          |01
|  */                                                                  |02
| (LIKE ABOVE)                                                         |03
|                                                                      |22
| /* Data Collection                                                   |23
|  */                                                                  |24
| user_list = ''                                                       |25
| printer_list = ''                                                    |26
| pages_printed_by = 0                                                 |27
| loop i = 1 to infid.lines                                            |28
|   parse infid.line[i] date user node printer pages                   |29
|   if user_list.wordpos(user) = 0 then                                |30
|     do                                                               |31
|       user_list = user_list user                                     |32
|     end                                                              |33
|   if printer_list.wordpos(printer) = 0 then                          |34
|     do                                                               |35
|       printer_list = printer_list printer                            |36
|     end                                                              |37
|   pages_printed_by[user] = pages_printed_by[user] + pages            |38
|   pages_printed_by[printer] = pages_printed_by[printer] + pages      |39
| end                                                                  |40
|                                                                      |41
| /* display                                                           |42
|  */                                                                  |43
| list = user_list                                                     |44
| loop for list.words()                                                |45
|   parse list item list                                               |46
|   say item.left(12,'.')':' pages_printed_by[item].right(7)           |47
| end                                                                  |48
|                                                                      |49
| list = printer_list                                                  |50
| loop for list.words()                                                |51
|   parse list item list                                               |52
|   say item.left(12,'.')':' pages_printed_by[item].right(7)           |53
| end                                                                  |54
+----------------------------------------------------------------------+
                                                              pracc2.nrx
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../examples/pracc2.nrx">Download the  source for the pracc2.nrx example </A>
 
</PRE>

<P>
And this is what you will get on your screen:

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="80%" BGCOLOR="707070">
<tr><td>
<PRE>
....................................................................
rsl3pm1 (58) <STRONG>pacc2</STRONG>
Users:
clare.......:      25
marchesi....:     102
mount.......:     201
Printers:
prt11.......:      26
prt21.......:     200
prt56.......:     102
rsl3pm1 (59) <STRONG></STRONG>
....................................................................
                                                           pacc2.out
</td></tr>
</table>
 
</PRE>

<P>
 


<H2> <IMG SRC="yellowball.gif"> Linked Lists </H2>
<P>
<A NAME="IDX435"></A>
 
Another kind of data structure are <STRONG>linked lists</STRONG>.
With NetRexx you can easily simulate a linked list
data structure.
 
I remind you of what a linked list is:
 

<PRE>
 
POINTER  ---&#62;  data.1   +--&#62;  data.2
                        |
               info.1   |     info.2
                        |
               next.1 --+     next.2 --&#62; NULL
 
</PRE>

<P>
 


<H3> <IMG SRC="yellowball.gif"> Case study: a ps tree. </H3>
<P>
<A NAME="IDX436"></A>
<A NAME="IDX437"></A>
A good case study for the linked lists is a program
for building a <STRONG>ps</STRONG> command tree.
 
The UNIX <STRONG>ps</STRONG> command is used to
show the current status of processes running on your
machine. Each process has an <STRONG>id</STRONG> (the
<STRONG>processid</STRONG>) and a <STRONG>parent process</STRONG>
(also called <STRONG>ppid</STRONG>).
 
The output of the <STRONG>ps</STRONG> command does not immediately
show how a process is "linked" in terms of <STRONG>parent process</STRONG>
to the previous ones. Here is a typical example:
 

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="80%" BGCOLOR="707070">
<tr><td>
<PRE>
....................................................................
rsl3pm1 (226) <STRONG>ps -f</STRONG>
    USER   PID  PPID   C    STIME    TTY  TIME CMD
marchesi  8161 13399   6 20:35:42  pts/4  0:00 rexx ps1
marchesi 10723 13026   3 20:35:42  pts/4  0:00 bsh bsh bsh
marchesi 13026  8161   1 20:35:42  pts/4  0:00 rexx ps1
marchesi 13399  9555   1   Jan 25  pts/4  0:06 -usr/local/bin/tcsh
marchesi 14564 10723   8 20:35:42  pts/4  0:00 ps -f
rsl3pm1 (227) <STRONG></STRONG>
....................................................................
                                                             ps1.out
</td></tr>
</table>
 
</PRE>

<P>
For our discussion, the important columns are the second and the
third: the process that started all is the PID 13399; it generated
PID 8161; which generated 13026; which executed 10723; which finally
executed 14564 (and fortunately for us, nothing else other than
printing what you see here).
 
This is an "easy" case: if we had done a <STRONG>'ps -ef'</STRONG>,
you would have got even more than 100 processes in no
particular order.
 
Our <STRONG>pstree</STRONG> wants to make order in this 'mess', and see
how each process is linked by the parental relationship.
 
The following code does the job.
 
We skip all the 'unrelevant' portion of the program, since it
does not add anything to our discussion.
 
The first thing we do is execute the <STRONG>ps</STRONG> command
with the proper options, depending on whether we want to see
all the processes of the system <STRONG>ps -ef</STRONG>
or just the ones belonging to us <STRONG>ps -f</STRONG>.
 

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+------------------------------------------------------------------+
| if all                                                           |42
|   then rc = xexec('ps -ef' , 'ARRAY' , 'ABORT')                  |43
|   else rc = xexec('ps -f'  , 'ARRAY' , 'ABORT')                  |44
+------------------------------------------------------------------+
</td></tr>
</table>
 
</PRE>

<P>
We reorder copy the array <STRONG>out[]</STRONG> into the array
<STRONG>ps[]</STRONG>. We skip the very first line of the
<STRONG>ps</STRONG> command output.

</P>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+------------------------------------------------------------------+
| j = 0                                                            |45
| loop i = 2 to out[0]                                             |46
|   j = j+1                                                        |47
|   ps[j] = out[i]                                                 |48
| end                                                              |49
| ps[0] = out[0] -1                                                |50
+------------------------------------------------------------------+
</td></tr>
</table>
 
</PRE>

<P>
We now create two lists: the <STRONG>pidl</STRONG> is a string containing
all the process_ids, while the <STRONG>ppidl</STRONG> is a string containing
all the processes that are parents.
The full information about the process
is stored in the array <STRONG>info[PID]</STRONG>
and the parent for each process is in <STRONG>ppid[PID]</STRONG>

</P>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+------------------------------------------------------------------+
| pidl  = ''                                                       |52
| ppidl = ''                                                       |53
| do i = 1 to ps[0]                                                |54
|   parse ps[i] . pid ppid .                                       |55
|   pidl = pidl pid                                                |56
|   ppidl = ppidl ppid                                             |57
|   info[pid] = ps[i]   -- full process info                       |58
|   ppid[pid] = ppid    -- parent                                  |59
| end                                                              |60
+------------------------------------------------------------------+
</td></tr>
</table>
 
</PRE>

<P>
We loop over the process list. We look for the processes that
<STRONG>are not parents of other processes</STRONG>.
Those processes are saved in  <STRONG>lastl</STRONG>: they are the
last in a chain of processes.

</P>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+------------------------------------------------------------------+
| list  = pidl                                                     |62
| lastl = ''                                                       |63
| loop list.words()                                                |64
|   parse list item list                                           |65
|   if ppidl.wordpos(item) = 0 then                                |66
|     do                                                           |67
|       lastl = lastl item                                         |68
|     end                                                          |69
| end                                                              |70
+------------------------------------------------------------------+
</td></tr>
</table>
 
</PRE>

<P>
Now the most tricky part. We start from all the processes
in <STRONG>lastl</STRONG> and go backwards. This is where we use the
pseudo linked list.
For each process in <STRONG>lastl</STRONG> we build the chain with
the processes in order of generation.

</P>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+------------------------------------------------------------------+
| list = lastl                                                     |72
| loop list.words()                                                |73
|   parse list item list                                           |74
|   titem = ppid[item]                                             |75
|   chain[item] = titem item                                       |76
|   loop forever                                                   |77
|     titem = ppid[titem]                                          |78
|     if pidl.wordpos(titem) = 0 then leave                        |79
|     chain[item] = titem chain[item]                              |80
|   end                                                            |81
| end                                                              |82
+------------------------------------------------------------------+
</td></tr>
</table>
 
</PRE>

<P>
Et voila': we have now only to print this chain.

</P>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+------------------------------------------------------------------+
| list = lastl                                                     |84
| loop list.words()                                                |85
|   parse list item list                                           |86
|   llist = chain[item]                                            |87
|   say ' '                                                        |88
|   loop llist.words()                                             |89
|     parse llist item2 llist                                      |90
|     parse info[item2] owner p1 p2 . rest                         |91
|     say p1.left(6) p2.left(6) '['owner']'left(,10) rest.left(50) |92
|   end                                                            |93
| end                                                              |94
+------------------------------------------------------------------+
</td></tr>
</table>
 
</PRE>

<P>
A short output example:

</P>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="80%" BGCOLOR="707070">
<tr><td>
<PRE>
....................................................................
rsl3pm1 (231) <STRONG>pstree -a</STRONG>
 
(...)
 
1      0      [root]       Jan 19      -  9:28 /etc/init
2584   1      [marchesi]   Jan 19  hft/0  0:01 -tcsh
5668   2584   [marchesi]   Jan 19  hft/0  0:00 xinit
6698   5668   [marchesi]   Jan 19  hft/0  0:19 mwm
7220   6698   [marchesi]   Jan 19      -  0:16 aixterm
8765   7220   [marchesi]   Jan 19  pts/0  0:01 -tcsh
12329  8765   [marchesi]   Jan 24  pts/0  0:00 rlogin sgil301 -l f
13610  12329  [marchesi]   Jan 24  pts/0  0:00 rlogin sgil301 -l f
 
1      0      [root]       Jan 19      -  9:28 /etc/init
9555   1      [marchesi]   Jan 25  hft/0  1:16 aixterm
13399  9555   [marchesi]   Jan 25  pts/4  0:06 -usr/local/bin/tcsh
8174   13399  [marchesi] 20:59:12  pts/4  0:00 rexx pstree -a
13039  8174   [marchesi] 20:59:13  pts/4  0:00 rexx pstree -a
10736  13039  [marchesi] 20:59:13  pts/4  0:00 bsh bsh bsh
14577  10736  [marchesi] 20:59:13  pts/4  0:00 ps -ef
 
1      0      [root]       Jan 19      -  9:28 /etc/init
7746   1      [marchesi]   Jan 19  hft/0  6:15 aixterm
9030   7746   [marchesi]   Jan 19  pts/2  0:03 -usr/local/bin/tcsh
15292  9030   [marchesi] 20:14:31  pts/2  0:48 x rxuser.texinfo
rsl3pm1 (231) <STRONG></STRONG>
....................................................................
                                                          pstree.out
</td></tr>
</table>
 
</PRE>

<P>
 


<H2> <IMG SRC="yellowball.gif"> Additional information on Data Structures </H2>
<P>
<A NAME="IDX438"></A>
You can find additional information about data structures in Java at those URLs:

</P>

<PRE>
 
<A href="http://www.geocities.com/SiliconValley/Way/7650/javadata.html">http://www.geocities.com/SiliconValley/Way/7650/javadata.html</A>

<A href="http://www.objectspace.com/jgl/">http://www.objectspace.com/jgl/</A>
 
</PRE>


<PRE>
 
<B> *** This section is: </B>
<B> <img src="underc.gif"> </B>
<B> *** and will be available in next releases</B>

</PRE>



<H2> <IMG SRC="yellowball.gif"> Summary </H2>
<P>
<EM>A resume' of the main concepts encountered in this chapter.</EM>

</P>

<PRE>
 
<B> *** This section is: </B>
<B> <img src="underc.gif"> </B>
<B> *** and will be available in next releases</B>

</PRE>

<P>
 
<P><HR><P>
</BODY>
</HTML>
<PRE>
File: nr_26.html.
</PRE>
<HR>
<FONT SIZE=-1 COLOR="4D4DFF">
The contents of this WEB page are Copyright &copy 1997 by Pierantonio Marchesini / ETH Zurich.<P>
Last update was done on 18 May 1998 21:48:01(GMT +2).
</FONT>


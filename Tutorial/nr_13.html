<HTML>
<HEAD>

<TITLE>NetRexx Tutorial - Operations on files</TITLE>
<table cellpadding=7>
<tr valign=top>
<td><img src="NetRexx.gif" width=64 height=64 alt=""></td>
<td>
<font size=6 color=darkblue><strong>The NetRexx Tutorial
<br>
<IMG SRC="l_red.gif"> -  Operations on files </font></strong>
</td></tr></table>
<TITLE>NetRexx Tutorial - Operations on files</TITLE>
</HEAD>
<BODY>
<P><HR><P>


<H1> Operations on files </H1>
<P>
<A NAME="IDX251"></A>


<H2> <IMG SRC="yellowball.gif"> Introduction </H2>
<P>
<EM>
File I/O has always been a 'problem' in REXX. In fact, REXX was
born as a platform-independent language. 
There were no (at least not
in the first specifications of the language) direct ways to access informations
stored into a file. This led to (quoting some examples) EXECIO in VM/CMS,
CMS/PIPES in later VM/CMS, STREAMS in OS/2, etc.
</EM>

</P>
<P>
<EM>In NetRexx we use the file access routines that Java
provides.</EM>
 
<EM>
In this chapter we will discuss how to access file information
using NetRexx. You will learn how to:</EM>

<UL>
<LI><EM>read/write a file in one single operation;</EM>

<LI><EM>use 'pseudo' RECFM F files on UNIX;</EM>

<LI><EM>use indexed file and get a random

record out of 1 000 000 within a millisecond.</EM>
</UL>

<P>
<EM>
We will perform this task using an OOP approach.</EM>

</P>
<P>
<EM>Thanks to
Massimiliano (Max) Marsiglietti, a NetRexx porting
of the functions <STRONG>STREAM, CHARIN, CHAROUT</STRONG> etc.
has been done.
Those routines will be discussed in the latest section of this
chapter.</EM>
 


<H2> <IMG SRC="yellowball.gif"> Basic Concepts </H2>



<H3> <IMG SRC="yellowball.gif"> The Stream I/O model </H3>
<P>
<A NAME="IDX252"></A>
<A NAME="IDX253"></A>

</P>
<P>
In NetRexx (like in Java) all the I/O mechanism is built
on <STRONG>Streams</STRONG>. The idea of Streams is similar
(but not related) to the STREAMS in the Unix Kernel.

</P>
<P>
The Stream class gives you a mechanism "to get from" or
"to put in" data into "somewhere". This "somewhere"
can be a file, a screen or keyboard, the network, an
audio device, etc. Your program will not have to care
about the "details" in the implementation. It will
just <STRONG>read()</STRONG> or <STRONG>write()</STRONG> to the
Input or Output Stream.

</P>

<PRE>
 
                            _____________
                           (             )
   read()   &#60;---(bytes)---( Input  Stream )
                           (_____________)

                            _____________
                           (             )
   write()  ----(bytes)--&#62;( Output Stream )
                           (_____________)

 
</PRE>



<H3> <IMG SRC="yellowball.gif"> Read/Write in Blocks </H3>
<P>
<A NAME="IDX254"></A>
<A NAME="IDX255"></A>
Before going into the details concerning the file I/O
operations, let me clarify a point
which is, in my opinion, extremely important. 

</P>
<P>
I have always found the approach in which one tries to
"confine" the operations on files inside subroutines more
elegant, and easier to port and maintain.
 
This is in contrast with the usual practice of intermixing
file operations with the normal program flow.
Let me make this clearer. The 'standard' approach is the following:

<PRE>
 
  -- "standard" approach to file
  -- Read/Write
  open INPUT_FILE
  open OUTPUT_FILE
 
  do while THERE_ARE_RECORDS
    read INPUT_FILE
    process RECORD
    write OUTPUT_FILE
  end
 
  close INPUT_FILE
  close OUTPUT_FILE

 
</PRE>

<P>
what I prefer is the following:

</P>

<PRE>
 
   -- "alternative" and "preferred"     *** BETTER ***
   -- approach to FILE I/O

   -- opening/reading/closing
   -- of the input file is done inside the rd_file
   -- method
   read_file INPUT_FILE
 
   do for RECORDS
     process RECORD
   end
 
   -- opening/writing/closing
   -- of the output file is done inside the wr_file
   -- method
   write_file OUTPUT_FILE

 
</PRE>

<P>
All the 'dirty' jobs (checking file existence, opening,
closing, transferring data to and from an array, etc.)
are reduced by this approach to ONLY two methods
(the <STRONG>read_file</STRONG> and the <STRONG>write_file</STRONG>).
 
There are cases where ( as we shall
see ) there is no choice other than
to take the first approach, but these are rare. 
I have personally used the second in 95% of programs and, again, 
it is easier to read, easier to port, simpler to maintain.
 
You might ask yourself why I stress the benefits
of code porting. An example is the code 
on VM/CMS written some years ago. In the early versions
of Rexx there were NO instructions for file I/O,
so someone was obliged to use the "infamous"
EXECIO instruction. If all the instructions are
'confined' in two subroutines (now we call'm methods) , the changes
are minimal when the code is ported. Otherwise
you will need to change it in hundreds of places (if the
program is big). And the more changes you make,
the more bugs that can slip in.
 
Summary: use simple methods for file I/O operations
as much as you can; some of those methods you can see
later in this chapter.
 


<H2> <IMG SRC="yellowball.gif"> Checking file existence </H2>
<P>
<A NAME="IDX256"></A>
<A NAME="IDX257"></A>
<A NAME="IDX258"></A>
The first thing you might want to do on a file is to check
that it really exists.
You can use the <STRONG>xfile</STRONG> built-in function 'state':

<PRE>
 
rc = <STRONG>xfile.state(<EM>file_id</EM>)</STRONG>
 
</PRE>

<P>
Alternatively, you could use the HEP/VM function fexist
(file exist):

<PRE>
 
rc = <STRONG>xfile.fexist(<EM>file_id</EM>)</STRONG>
 
</PRE>

<P>
 
The output variable (rc in this example) has the following meaning
for both functions:

<PRE>
 
   rc   = 0  : file does NOT exist
   rc   = 1  : file exists
 
</PRE>

<P>
Here a small example of the function:

</P>
<P>
<A NAME="IDX259"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- (...)                                                             |<STRONG>01</STRONG>
| if \xfile.state('xstring.nrx')                                       |<STRONG>02</STRONG>
|   then say 'File does not exist.'                                    |<STRONG>03</STRONG>
|                                                                      |<STRONG>04</STRONG>
| if \xfile.fexist('/usr/local/bin/tcsh')                              |<STRONG>05</STRONG>
|   then say 'TCSH not present.'                                       |<STRONG>06</STRONG>
|                                                                      |<STRONG>07</STRONG>
| exit 0                                                               |<STRONG>08</STRONG>
+----------------------------------------------------------------------+
                                                               fexa1.nrx
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../examples/fexa1.nrx">Download the  source for the fexa1.nrx example </A>
 
</PRE>

<P>
The implementation of those functions is trivial:

</P>
<P>
<A NAME="IDX260"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: state                                               |<STRONG>39</STRONG>
| -- purpose.....: check file existence                                |<STRONG>40</STRONG>
| --                                                                   |<STRONG>41</STRONG>
|   method state(fid=Rexx) public static                               |<STRONG>42</STRONG>
|     in = File(fid)                                                   |<STRONG>43</STRONG>
|     fl = in.exists()                                                 |<STRONG>44</STRONG>
|     return fl                                                        |<STRONG>45</STRONG>
|                                                                      |<STRONG>46</STRONG>
+----------------------------------------------------------------------+
                                                 xfile.nrx(Method:state)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/xfile.nrx">Download the complete source for the xfile.nrx library </A>
 
</PRE>



<H2> <IMG SRC="yellowball.gif"> Basic File operations in Java. </H2>
<P>
<A NAME="IDX261"></A>
<EM>
This entire section should be regarded as "reference" only.
You will find, in fact, the basic I/O operations that you perform
on a file. In my humble opinion it is nice to know these
functions exist, but it is much better to use
higher level subroutines that do all the work for you.
</EM>
 
<EM>
Therefore, you should skip this section if you are not really interested in
the detail.</EM>
 


<H3> <IMG SRC="yellowball.gif"> Java classes for File access </H3>


<UL>
<LI>java.io.File

<LI>java.io.FileDescriptor

<LI>java.io.RandomAccessFile

<LI>java.io.InputStream

<LI>java.io.OutputStream

<LI>java.io.PrintStream

</UL>


<PRE>
 
<B> *** This section is: </B>
<B> <img src="underc.gif"> </B>
<B> *** and will be available in next releases</B>

</PRE>



<H2> <IMG SRC="yellowball.gif"> Writing an extension to the Java File class </H2>
<P>
<A NAME="IDX262"></A>
<A NAME="IDX263"></A>
<A NAME="IDX264"></A>

</P>
<P>
In the previous chapter we showed the advantages of the OOP. We now
even more clarify those advantages building our own extensions to the
java.lang.Object class <STRONG>File</STRONG>. 

</P>
<P>
This new class ( that we'll call <STRONG>xfile</STRONG> ) will allow
us to:

</P>

<UL>
<LI>use an intermediate array to buffer READ or WRITE

      operations
<LI>perform appends to existing files

<LI>simulate fixed length files (RECFM F)

<LI>allow the building of an index for fast random access

      record retrieval
</UL>



<H3> <IMG SRC="yellowball.gif"> Reading and Writing a whole file. </H3>
<P>
<A NAME="IDX265"></A>
<A NAME="IDX266"></A>
<A NAME="IDX267"></A>

</P>
<P>
  It is sometimes desirable to read or write an ENTIRE file
(i.e. from the first to the last line) with a single operation.
This approach has the obvious advantage of giving
'somebody else' all the bother of opening, read/write
and closing a file. That 'somebody' is merely the
code that performs the function.
 
  The only drawback to such an operation is that, especially
if the file is big, it uses a lot of system resources.
Therefore, as a rule of thumb, use the ENTIRE file approach only
for files &#60; 1MB in size when you already know
you are using ALL the records.
 


<H3> <IMG SRC="yellowball.gif"> Implementation of read() and write() in xfile. </H3>
<P>
<A NAME="IDX268"></A>
<A NAME="IDX269"></A>

</P>

<PRE>
 
<B> *** This section is: </B>
<B> <img src="underc.gif"> </B>
<B> *** and will be available in next releases</B>

</PRE>

<P>
<A NAME="IDX270"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: read                                                |<STRONG>95</STRONG>
| -- purpose.....: read a full file into an array                      |<STRONG>96</STRONG>
| --                                                                   |<STRONG>97</STRONG>
|   method read() public                                               |<STRONG>98</STRONG>
|     rc = 0                                                           |<STRONG>99</STRONG>
|     do                                                               |<STRONG>00</STRONG>
|       in = DataInputStream(FileInputStream(File(name)))              |<STRONG>01</STRONG>
|     catch er=ioException                                             |<STRONG>02</STRONG>
|       rc = 3                                                         |<STRONG>03</STRONG>
|       return rc                                                      |<STRONG>04</STRONG>
|     end                                                              |<STRONG>05</STRONG>
|                                                                      |<STRONG>06</STRONG>
|     i = 0                                                            |<STRONG>07</STRONG>
|     loop while in.available &#60;&#62; 0                                     |<STRONG>08</STRONG>
|       i = i+1                                                        |<STRONG>09</STRONG>
|       line[i] = in.readLine                                          |<STRONG>10</STRONG>
|     catch er=ioException                                             |<STRONG>11</STRONG>
|       say 'Problem reading file "'name'".'                           |<STRONG>12</STRONG>
|       say 'Message is "'er'".'                                       |<STRONG>13</STRONG>
|       rc = 1                                                         |<STRONG>14</STRONG>
|       return rc                                                      |<STRONG>15</STRONG>
|     end                                                              |<STRONG>16</STRONG>
|     line[0] = i                                                      |<STRONG>17</STRONG>
|     lines = line[0]                                                  |<STRONG>18</STRONG>
|     return rc                                                        |<STRONG>19</STRONG>
|                                                                      |<STRONG>20</STRONG>
+----------------------------------------------------------------------+
                                                  xfile.nrx(Method:read)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/xfile.nrx">Download the complete source for the xfile.nrx library </A>
 
</PRE>

<P>
<A NAME="IDX271"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: write                                               |<STRONG>80</STRONG>
| -- purpose.....: ARRAY -&#62; disk file operation                        |<STRONG>81</STRONG>
| --                                                                   |<STRONG>82</STRONG>
|   method write() public                                              |<STRONG>83</STRONG>
|     rc = 0                                                           |<STRONG>84</STRONG>
|     do                                                               |<STRONG>85</STRONG>
|       out = PrintStream(FileOutputStream(File(name)))                |<STRONG>86</STRONG>
|     catch er=ioException                                             |<STRONG>87</STRONG>
|       say 'Problem opening file "'name'".'                           |<STRONG>88</STRONG>
|       say 'Message is "'er'".'                                       |<STRONG>89</STRONG>
|       rc = 3                                                         |<STRONG>90</STRONG>
|       return rc                                                      |<STRONG>91</STRONG>
|     end                                                              |<STRONG>92</STRONG>
|                                                                      |<STRONG>93</STRONG>
|     loop i = 1 to line[0]                                            |<STRONG>94</STRONG>
|       linew = line[i]                                                |<STRONG>95</STRONG>
|       if recfm = 'F' then           -- is recfm = F ?                |<STRONG>96</STRONG>
|         do                          -- Yup, insert the right amount  |<STRONG>97</STRONG>
|           linew = linew.left(lrecl) --      of spaces (or truncate   |<STRONG>98</STRONG>
|         end                         --      if necessary)            |<STRONG>99</STRONG>
|       out.println(linew)                                             |<STRONG>00</STRONG>
|     end                                                              |<STRONG>01</STRONG>
|                                                                      |<STRONG>02</STRONG>
|     -- we're done. but do not forget to close                        |<STRONG>03</STRONG>
|     -- and flush the printstream                                     |<STRONG>04</STRONG>
|     --                                                               |<STRONG>05</STRONG>
|     out.close()                                                      |<STRONG>06</STRONG>
|     if out.checkError() then                                         |<STRONG>07</STRONG>
|       do                                                             |<STRONG>08</STRONG>
|         say 'ERROR in writing "'name'".'                             |<STRONG>09</STRONG>
|         rc = 1                                                       |<STRONG>10</STRONG>
|       end                                                            |<STRONG>11</STRONG>
|     return rc                                                        |<STRONG>12</STRONG>
|                                                                      |<STRONG>13</STRONG>
+----------------------------------------------------------------------+
                                                 xfile.nrx(Method:write)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/xfile.nrx">Download the complete source for the xfile.nrx library </A>
 
</PRE>



<H3> <IMG SRC="yellowball.gif"> How to use the new methods. </H3>

<P>
You use the methods in the following way:
 

<PRE>
 
 
   infid = xfile('test.input')

   rc = infid.read()
   --   ----- ------  
    |      |    |   
    |      |    +------------&#60; read operation
    |      +-----------------&#60; file object
    +------------------------&#60; ==0 : OK
                               &#60;&#62;0 : problem

   (...)

   oufid = xfile('test.output')

   rc = oufid.write()
   --   ----- ------  
    |      |    |   
    |      |    +------------&#60; read operation
    |      +-----------------&#60; file object
    +------------------------&#60; ==0 : OK
                               &#60;&#62;0 : problem

 
</PRE>

<P>
 


<H3> <IMG SRC="yellowball.gif"> Example of reading of an entire file. </H3>
<P>
<A NAME="IDX272"></A>
<A NAME="IDX273"></A>
If you need to read an entire file and put its contents into
the ARRAY variable, you use the <STRONG>.read()</STRONG> method.
 
Let's follow a complete example.
 
Suppose your input file is <STRONG>test.data</STRONG>, and it looks like:
 

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------+
| data info 1                                        |
| data info 2                                        |
| (...)                                              |
| data info N                                        |
+----------------------------------------------------+
file: <STRONG>test.data</STRONG>
</td></tr>
</table>
 
</PRE>

<P>
 
You read the ENTIRE file by calling
 

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+------------------------------------------------------------------+
| (...)                                                            |
| infid = xfile('test.file')                                       |
| (...)                                                            |
| rc = infid.read()                                                |
| if rc &#60;&#62; 0 then      /* action on READ fail */                   |
| (...)                                                            |
+------------------------------------------------------------------+
                                                Example: read a file
</td></tr>
</table>
 
</PRE>

<P>
 
AFTER the call, if rc was == 0, you get the values
 

<PRE>
 
  infid.line[0]  :   N
  infid.line[1]  :   'data info 1'
  infid.line[2]  :   'data info 2'
  (...)
  infid.line[N]  :   'data info N'
 
</PRE>

<P>
 
You can now process the lines with a loop, such as

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+------------------------------------------------------------------+
| (...)                                                            |
| loop i = 1 to infid.line[0]                                      |
|   parse infid.line[i] (...)                                      |
|   (...)                                                          |
| end                                                              |
| (...)                                                            |
+------------------------------------------------------------------+
                                       Example: post read processing
</td></tr>
</table>
 
</PRE>

<P>
 


<H3> <IMG SRC="yellowball.gif"> Writing a whole file </H3>
<P>
<A NAME="IDX274"></A>

</P>
<P>
Now consider the opposite situation, where we accumulate
information into an ARRAY and we want
to write a file with it (for example <CODE>test.output</CODE>).
 

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+------------------------------------------------------------------+
| (...)                                                            |
| oufid = xfile('test.output')                                     |
| (...)                                                            |
| loop i = 1 to 30                                                 |
|   (...)                                                          |
|   oufid.addline('Output line' i)                                 |
| end                                                              |
| (...)                                                            |
| rc = oufid.write()                                               |
| if rc &#60;&#62; 0 then      /* action on WRITE fail */                  |
| (...)                                                            |
+------------------------------------------------------------------+
                                                Example: read a file
</td></tr>
</table>
 
</PRE>

<P>
 


<H2> <IMG SRC="yellowball.gif"> Read/Write access to a file (line by line) </H2>



<H3> <IMG SRC="yellowball.gif"> Reading a file line by line </H3>
<P>
<A NAME="IDX275"></A>
It is sometimes more desirable to read a file line by line
and perform certain tasks within the reading loop.
A typical case is when the input file is REALLY big ; for example,
a 200MB tape or database. Another instance is when you really
do not need to read all the records of the file, but only
certain selected ones ; for example, all the accounting cards
for a certain user.
 
The logic is the following:
 

<PRE>
 

open(file)
do while NOT(EOF)
  record = readline(file)
  --
  -- processing
  --
end
close(file)

 
</PRE>

<P>
 
The following code is an example of this approach.
You will notice that it is far more expensive in terms of instructions
and complexity than the <STRONG>read()</STRONG> example.

</P>

<PRE>
 
<B> *** This section is: </B>
<B> <img src="underc.gif"> </B>
<B> *** and will be available in next releases</B>

</PRE>



<H3> <IMG SRC="yellowball.gif"> Writing a file line-by-line </H3>
<P>
It is also interesting to consider writing a file line-by-line. 
This is again a case where the file
being produced is big, or where you do
not want to store it inside an ARRAY variable.
 
The logic is
 

<PRE>
 

open(file)               
do for all records               
  --
  -- processing
  --
  writeline(file,record)
end                              
close(file)                      

 
</PRE>

<P>
 
Here is a complete example:
 

<PRE>
 
<B> *** This section is: </B>
<B> <img src="underc.gif"> </B>
<B> *** and will be available in next releases</B>

</PRE>



<H2> <IMG SRC="yellowball.gif"> Read/Write access to a fixed-format record file </H2>
<P>
<A NAME="IDX276"></A>
<A NAME="IDX277"></A>
<A NAME="IDX278"></A>

</P>
<P>
Unlike the VM/CMS and MVS systems,
UNIX and Windows systems have no concept of RECORDS in files,
so there is not much point in referring to LRECL and RECFM.
 
However, using the <STRONG>xfile</STRONG> class you can
access for read and for write
a 'pseudo' fixed length file such as you are used on
VM or on MVS.
 
The advantage of these files is that you can
access them on a record basis and use the record number
as the index.

</P>
<P>
Suppose, for example, you have a TAPE database containing
300 000 records. To access the 283 954th one, where the records
are all of the same length, you simply need to position yourself
at the 283.954*RECL byte, and operate over a RECL
quantity.  And that is what the following functions will do.
 
A 'pseudo' RECFM F LRECL 16 file will
appear like this on your system:
 

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="80%" BGCOLOR="707070">
<tr><td>
<PRE>
.........    --------------------------------------------------
record 01    t  h  i  s     i  s     a     t  e  s  t
  (hex)      74 68 69 73 20 69 73 20 61 20 74 65 73 74 20 20 0A
record 02    a  n  o  t  h  e  r     l  i  n  e
  (hex)      61 6E 6F 74 68 65 72 20 6C 69 6E 65 20 20 20 20 0A
record 03    l  a  s  t     o  n  e
  (hex)      6C 61 73 74 20 6F 6E 65 20 20 20 20 20 20 20 20 0A
.........    --------------------------------------------------
</td></tr>
</table>
 
</PRE>

<P>
This file does have three records of 16 (actually 17 with the
'0A'x character) characters, so it occupies 51 bytes of
disk space.
Note that the '0A'x character is not mandatory. You could
rewrite the routines presented herein in order to avoid it.
I prefer having it so that I can look at the produced files with an
editor or a browser.
 
The format of the function to access a RECFM F file
is the following:
 

<PRE>
 
  fid = xfile('test.FIXED')
  fid.options('recfm=F,lrecl=80')

  -- write record 120
  fid.recwrite(120,'Test')

  -- read record 133
  parse fid.recread(133) rc line
 
</PRE>

<P>
The methods are the following:
<A NAME="IDX279"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: recio                                               |<STRONG>53</STRONG>
| -- purpose.....: RANDOM access file record read                      |<STRONG>54</STRONG>
| --                                                                   |<STRONG>55</STRONG>
|   method recio(oper=Rexx,recno=Rexx,out=Rexx) public                 |<STRONG>56</STRONG>
|     rc = 0                                                           |<STRONG>57</STRONG>
|                                                                      |<STRONG>58</STRONG>
|     -- checks &#38; initialization                                       |<STRONG>59</STRONG>
|     --                                                               |<STRONG>60</STRONG>
|     oper = oper.upper()                                              |<STRONG>61</STRONG>
|     if recfm &#60;&#62; 'F' then                                             |<STRONG>62</STRONG>
|       do                                                             |<STRONG>63</STRONG>
|         rc = 10                                                      |<STRONG>64</STRONG>
|         return rc 'ERROR: not a RECFM=F file.'                       |<STRONG>65</STRONG>
|       end                                                            |<STRONG>66</STRONG>
|     raff = File(name)                                                |<STRONG>67</STRONG>
|     size = int raff.length()                                         |<STRONG>68</STRONG>
|     skip = (recno-1)*(lrecl+1)                                       |<STRONG>69</STRONG>
|     skip = int skip                                                  |<STRONG>70</STRONG>
|     if size &#60;= skip then                                             |<STRONG>71</STRONG>
|       do                                                             |<STRONG>72</STRONG>
|         rc = 11                                                      |<STRONG>73</STRONG>
|         return rc 'ERROR: past file end.'                            |<STRONG>74</STRONG>
|       end                                                            |<STRONG>75</STRONG>
|                                                                      |<STRONG>76</STRONG>
|     -- access as a Random File                                       |<STRONG>77</STRONG>
|     -- and skip till the beginning of record                         |<STRONG>78</STRONG>
|     do                                                               |<STRONG>79</STRONG>
|       raf = RandomAccessFile(name,"rw")                              |<STRONG>80</STRONG>
|     catch er=ioException                                             |<STRONG>81</STRONG>
|       say 'Problem opening file "'name'".'                           |<STRONG>82</STRONG>
|       say 'Message is "'er'".'                                       |<STRONG>83</STRONG>
|       rc = 3                                                         |<STRONG>84</STRONG>
|       return rc                                                      |<STRONG>85</STRONG>
|     end                                                              |<STRONG>86</STRONG>
|     do                                                               |<STRONG>87</STRONG>
|       raf.skipBytes(skip)                                            |<STRONG>88</STRONG>
|     catch er=ioException                                             |<STRONG>89</STRONG>
|       rc = 4                                                         |<STRONG>90</STRONG>
|       return rc                                                      |<STRONG>91</STRONG>
|     end                                                              |<STRONG>92</STRONG>
|                                                                      |<STRONG>93</STRONG>
|     if oper = 'READ' then                                            |<STRONG>94</STRONG>
|       do                                                             |<STRONG>95</STRONG>
|         do                                                           |<STRONG>96</STRONG>
|           line = raf.readLine()                                      |<STRONG>97</STRONG>
|         catch er=ioException                                         |<STRONG>98</STRONG>
|           say 'Problem reading file "'name'".'                       |<STRONG>99</STRONG>
|           say 'Message is "'er'".'                                   |<STRONG>00</STRONG>
|           rc = 3                                                     |<STRONG>01</STRONG>
|           return rc                                                  |<STRONG>02</STRONG>
|         end                                                          |<STRONG>03</STRONG>
|         return rc line                                               |<STRONG>04</STRONG>
|       end                                                            |<STRONG>05</STRONG>
|                                                                      |<STRONG>06</STRONG>
|     -- is it a WRITE operation?                                      |<STRONG>07</STRONG>
|     --                                                               |<STRONG>08</STRONG>
|     if oper = 'WRITE' then                                           |<STRONG>09</STRONG>
|       do                                                             |<STRONG>10</STRONG>
|         do                                                           |<STRONG>11</STRONG>
|           linew = out.left(lrecl)                                    |<STRONG>12</STRONG>
|           buf = linew'\x0A'                                          |<STRONG>13</STRONG>
|           raf.writebytes(buf)                                        |<STRONG>14</STRONG>
|         catch er=ioException                                         |<STRONG>15</STRONG>
|           say 'Problem reading file "'name'".'                       |<STRONG>16</STRONG>
|           say 'Message is "'er'".'                                   |<STRONG>17</STRONG>
|           rc = 3                                                     |<STRONG>18</STRONG>
|           return rc                                                  |<STRONG>19</STRONG>
|         end                                                          |<STRONG>20</STRONG>
|         return 0                                                     |<STRONG>21</STRONG>
|       end                                                            |<STRONG>22</STRONG>
|     return 11                                                        |<STRONG>23</STRONG>
|                                                                      |<STRONG>24</STRONG>
+----------------------------------------------------------------------+
                                                 xfile.nrx(Method:recio)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/xfile.nrx">Download the complete source for the xfile.nrx library </A>
 
</PRE>

<P>
<A NAME="IDX280"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: recwrite                                            |<STRONG>32</STRONG>
| -- purpose.....: RANDOM access file record write                     |<STRONG>33</STRONG>
| --                                                                   |<STRONG>34</STRONG>
|   method recwrite(recno=Rexx,rec=Rexx) public                        |<STRONG>35</STRONG>
|     out = recio('WRITE',recno,rec)                                   |<STRONG>36</STRONG>
|     return out                                                       |<STRONG>37</STRONG>
|                                                                      |<STRONG>38</STRONG>
+----------------------------------------------------------------------+
                                              xfile.nrx(Method:recwrite)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/xfile.nrx">Download the complete source for the xfile.nrx library </A>
 
</PRE>

<P>
The following program makes use of the above methods, showing all
the possibilities:
 
<A NAME="IDX281"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- test the xfile fixed record feature                               |<STRONG>01</STRONG>
| --                                                                   |<STRONG>02</STRONG>
| parse arg what                                                       |<STRONG>03</STRONG>
| what = what                                                          |<STRONG>04</STRONG>
|                                                                      |<STRONG>05</STRONG>
| fname = 'test.FIXED'                                                 |<STRONG>06</STRONG>
| fid = xfile(fname)                                                   |<STRONG>07</STRONG>
| fid.options('recfm=F,lrecl=16')                                      |<STRONG>08</STRONG>
|                                                                      |<STRONG>09</STRONG>
| say 'Accessing file "'fid.name'".'                                   |<STRONG>10</STRONG>
| fid.addline('this is a test')                                        |<STRONG>11</STRONG>
| fid.addline('another line')                                          |<STRONG>12</STRONG>
| fid.addline('last one')                                              |<STRONG>13</STRONG>
|                                                                      |<STRONG>14</STRONG>
| rc = fid.write()                                                     |<STRONG>15</STRONG>
| say 'RC:' rc' writing "'fid.name'".'                                 |<STRONG>16</STRONG>
|                                                                      |<STRONG>17</STRONG>
| /* access a record                                                   |<STRONG>18</STRONG>
|  */                                                                  |<STRONG>19</STRONG>
| say fid.recread(2)                                                   |<STRONG>20</STRONG>
| say fid.recwrite(2,'New line 2')                                     |<STRONG>21</STRONG>
| say fid.recread(2)                                                   |<STRONG>22</STRONG>
|                                                                      |<STRONG>23</STRONG>
| exit                                                                 |<STRONG>24</STRONG>
+----------------------------------------------------------------------+
                                                                tfix.nrx
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../examples/tfix.nrx">Download the  source for the tfix.nrx example </A>
 
</PRE>

<P>
Some explication:
 
In line '08' we write a file, RECFM F LRECL 16 ,using the contents
of the stem <STRONG>list.</STRONG>.
 
The file will look like this:
 

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="80%" BGCOLOR="707070">
<tr><td>
<PRE>
.........    --------------------------------------------------
record 01    t  h  i  s     i  s     a     t  e  s  t
  (hex)      74 68 69 73 20 69 73 20 61 20 74 65 73 74 20 20 0A
record 02    a  n  o  t  h  e  r     l  i  n  e
  (hex)      61 6E 6F 74 68 65 72 20 6C 69 6E 65 20 20 20 20 0A
record 03    l  a  s  t     o  n  e
  (hex)      6C 61 73 74 20 6F 6E 65 20 20 20 20 20 20 20 20 0A
.........    --------------------------------------------------
</td></tr>
</table>
 
</PRE>

<P>
In line '11', we 'zap' the contents of the record 2, so our file
will look like this:

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="80%" BGCOLOR="707070">
<tr><td>
<PRE>
.........    --------------------------------------------------
record 01    t  h  i  s     i  s     a     t  e  s  t
  (hex)      74 68 69 73 20 69 73 20 61 20 74 65 73 74 20 20 0A
record 02    N  e  w     l  i  n  e     2
  (hex)      4E 65 77 20 6C 69 6E 65 20 32 20 20 20 20 20 20 0A
record 03    l  a  s  t     o  n  e
  (hex)      6C 61 73 74 20 6F 6E 65 20 20 20 20 20 20 20 20 0A
.........    --------------------------------------------------
</td></tr>
</table>
 
</PRE>

<P>
In line '14' we read the record we just zapped in an indexed way Ñ
i.e. we access JUST the 2nd record of the file.
 
If you run it, this is what you get:

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="80%" BGCOLOR="707070">
<tr><td>
<PRE>
....................................................................
rsl3pm1 (521) <STRONG>java tfix</STRONG>
0 another line
0
0 New line 2
rsl3pm1 (522) <STRONG></STRONG>
....................................................................
                                                             rwf.out
</td></tr>
</table>
 
</PRE>

<P>
You can look at the file with your preferred editor, and check that
it's really like I said.
 


<H2> <IMG SRC="yellowball.gif"> Indexed files </H2>
<P>
<A NAME="IDX282"></A>
<A NAME="IDX283"></A>
What we discussed about RECFM F files is also true for RECFM V
files. On VM/CMS and MVS systems, you can say: "get the record
NNN of this file", and you get it in a really fast way.
In UNIX, this is not possible. If you want the NNNth record
of a file, and the file is NOT fixed length, you MUST
read all the file till line NNNth (in the assumption that
a record corresponds to a line).
 
In this chapter we will analyse a method for overcoming this limitation,
so you can at least partially have the benefits of a RECFM V
file on VM/CMS.
 
We will write a routine that (without you doing anything) will
build an index file, and use it when you access the file itself.
 
The idea is the following: Whenever you build a variable
record length file (ex. <STRONG>test</STRONG>), an index table
for it is built automatically, containing for each
record the displacement (in bytes) from the beginning of the file itself.
As the table is RECFM F, it is easy to find the
NNNth record, and, from its contents, to identify
the REAL contents of record NNN.
 
Pictorially:

<PRE>
 
 
    +-------+       +-------------+
  1 |       |       |RRRRRRRR     |
  2 |       |       |RRRRRRRRRRR  |
  3 |ptr r3 |------&#62;|RRRRRRRRRR   |
  4 |       |       |R            |
  5 |       |       |RRRRRRRRRRR  |
    | (...) |       |  (...)      |
  N |       |       |RRRRRRR      |
    +-------+       +-------------+
    test.IDX        test
    (RECFM F)       (RECFM V)
 
 
</PRE>

<P>
 


<H3> <IMG SRC="yellowball.gif"> When should you use Indexed files? </H3>
<P>
 
The kind of applications that are well suited
for indexed files are those where you read
many times, RANDOMLY, a big file that you produce
or refresh infrequently. An example is the 'phone book' of a company
with hundreds of thousand of records, hashed in some particular
form. Another example is a tape database, where the Volume ID
of the tape is de-facto the key to accessing the file.
 


<H3> <IMG SRC="yellowball.gif"> pro and cons for Indexed files. </H3>
<P>
 
Clearly, if the file is big, the indexed method makes a search for
a random record as much as order of
magnitudes faster. The drawback is that EVERY time
you change the file, you need to refresh
the index and make sure that no access
to the file is made while the index is being built.
In addition, the index itself uses space Ñ a 1 million record file requires
an index file as large as 8MB. Of course if your records are big,
this will be just a small percentage of the total disk space, but if the
records are small, you risk the index file becoming bigger
than the file itself.
 


<H3> <IMG SRC="yellowball.gif"> The 'rw_filev' routine. </H3>
<P>
The 'rw_filev' routine is the 'kernel' of our discussion.
It has three subfunctions: one for writing a
file and, at the same time the file's
index, a second for building an index for an existing file,
and a third for reading a random record.
 

<PRE>
 
<B> *** This section is: </B>
<B> <img src="underc.gif"> </B>
<B> *** and will be available in next releases</B>

</PRE>



<H2> <IMG SRC="yellowball.gif"> Handling of binary files. </H2>
<P>
<A NAME="IDX284"></A>
It is sometimes useful to handle binary files.

</P>


<H3> <IMG SRC="yellowball.gif"> The xfile routines </H3>
<P>
The two <STRONG>xfile</STRONG> routines <STRONG>readbuf</STRONG> and
<STRONG>writebuf</STRONG> help you dealing with byte quantities.

</P>

<PRE>
 
                 readbuf()
  ( FILE )      -----------&#62;    fid.buffer
                                byte[size]
                &#60;-----------
                 writebuf()

 
</PRE>

<P>
<A NAME="IDX285"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: readbuf                                             |<STRONG>21</STRONG>
| -- purpose.....: read an entire file into a buffer                   |<STRONG>22</STRONG>
| --                                                                   |<STRONG>23</STRONG>
|   method readbuf() public                                            |<STRONG>24</STRONG>
|     rc = 0                                                           |<STRONG>25</STRONG>
|     do                                                               |<STRONG>26</STRONG>
|       fd   = File(name)                                              |<STRONG>27</STRONG>
|       size = int fd.length()                                         |<STRONG>28</STRONG>
|       off  = int 0                                                   |<STRONG>29</STRONG>
|       fis  = FileInputStream(fd)                                     |<STRONG>30</STRONG>
|       in   = DataInputStream(fis)                                    |<STRONG>31</STRONG>
|       buf  = byte[size]                                              |<STRONG>32</STRONG>
|       oprc = in.read(buf,off,size)                                   |<STRONG>33</STRONG>
|     catch er=ioException                                             |<STRONG>34</STRONG>
|       rc = 3                                                         |<STRONG>35</STRONG>
|       say '(readbuf) ERROR:' er'.'                                   |<STRONG>36</STRONG>
|       return rc                                                      |<STRONG>37</STRONG>
|     end                                                              |<STRONG>38</STRONG>
|     if oprc = size                                                   |<STRONG>39</STRONG>
|       then rc = 0                                                    |<STRONG>40</STRONG>
|       else rc = 1                                                    |<STRONG>41</STRONG>
|     buffer = buf                                                     |<STRONG>42</STRONG>
|     return rc                                                        |<STRONG>43</STRONG>
|                                                                      |<STRONG>44</STRONG>
+----------------------------------------------------------------------+
                                               xfile.nrx(Method:readbuf)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/xfile.nrx">Download the complete source for the xfile.nrx library </A>
 
</PRE>

<P>
The key instruction is:

<PRE>
 
   oprc = in.read(buf,off,size)
 
</PRE>

<P>
where we read from the input stream <STRONG>size</STRONG> bytes, and we place
them in a <STRONG>byte</STRONG> array called <STRONG>buffer</STRONG>.

</P>

<P>
<A NAME="IDX286"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: writebuf                                            |<STRONG>45</STRONG>
| -- purpose.....: write an entire buffer onto a file                  |<STRONG>46</STRONG>
| --                                                                   |<STRONG>47</STRONG>
|   method writebuf() public                                           |<STRONG>48</STRONG>
|     rc = 0                                                           |<STRONG>49</STRONG>
|     do                                                               |<STRONG>50</STRONG>
|       fd   = File(name)                                              |<STRONG>51</STRONG>
|       size = int buffer.length                                       |<STRONG>52</STRONG>
|       off  = int 0                                                   |<STRONG>53</STRONG>
|       fos  = FileOutputStream(fd)                                    |<STRONG>54</STRONG>
|       out  = DataoutputStream(fos)                                   |<STRONG>55</STRONG>
|       out.write(buffer,off,size)                                     |<STRONG>56</STRONG>
|       out.flush()                                                    |<STRONG>57</STRONG>
|       oprc = out.size()                                              |<STRONG>58</STRONG>
|       out.close()                                                    |<STRONG>59</STRONG>
|     catch er=ioException                                             |<STRONG>60</STRONG>
|       rc = 3                                                         |<STRONG>61</STRONG>
|       say '(writebuf) ERROR:' er'.'                                  |<STRONG>62</STRONG>
|       return rc                                                      |<STRONG>63</STRONG>
|     end                                                              |<STRONG>64</STRONG>
|     if oprc = size                                                   |<STRONG>65</STRONG>
|       then rc = 0                                                    |<STRONG>66</STRONG>
|       else rc = 1                                                    |<STRONG>67</STRONG>
|     return rc                                                        |<STRONG>68</STRONG>
|                                                                      |<STRONG>69</STRONG>
+----------------------------------------------------------------------+
                                              xfile.nrx(Method:writebuf)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/xfile.nrx">Download the complete source for the xfile.nrx library </A>
 
</PRE>



<H3> <IMG SRC="yellowball.gif"> Examples </H3>
<P>
Let's look to some real examples.
<A NAME="IDX287"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- test WRITE buffer                                                 |<STRONG>01</STRONG>
| --                                                                   |<STRONG>02</STRONG>
|                                                                      |<STRONG>03</STRONG>
| -- init a buffer, please                                             |<STRONG>04</STRONG>
| --                                                                   |<STRONG>05</STRONG>
| buf = byte[126]                                                      |<STRONG>06</STRONG>
| loop i = 1 to buf.length-1                                           |<STRONG>07</STRONG>
|   buf[i] = i                                                         |<STRONG>08</STRONG>
| end                                                                  |<STRONG>09</STRONG>
|                                                                      |<STRONG>10</STRONG>
| -- declare the output file                                           |<STRONG>11</STRONG>
| --                                                                   |<STRONG>12</STRONG>
| fn = 'twf.out'                                                       |<STRONG>13</STRONG>
| of = xfile(fn)                                                       |<STRONG>14</STRONG>
|                                                                      |<STRONG>15</STRONG>
| -- point to the buffer space                                         |<STRONG>16</STRONG>
| --                                                                   |<STRONG>17</STRONG>
| of.buffer = buf                                                      |<STRONG>18</STRONG>
|                                                                      |<STRONG>19</STRONG>
| -- OK, do the write                                                  |<STRONG>20</STRONG>
| --                                                                   |<STRONG>21</STRONG>
| rc = of.writebuf()                                                   |<STRONG>22</STRONG>
| say 'Write of "'fn'" got RC:' rc'.'                                  |<STRONG>23</STRONG>
|                                                                      |<STRONG>24</STRONG>
| exit                                                                 |<STRONG>25</STRONG>
+----------------------------------------------------------------------+
                                                                 twb.nrx
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../examples/twb.nrx">Download the  source for the twb.nrx example </A>
 
</PRE>

<P>
This is how your output file will look like, looking it using
<STRONG>hedit</STRONG> (see next section).

</P>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="80%" BGCOLOR="707070">
<tr><td>
<PRE>
......................................................................
rsl3pm1 (1) &#62; java hedit twf.out
Welcome to hedit.
d0000000 - 0001 0203 0405 0607 0809 0A0B 0C0D 0E0F  "................"
d0000016 - 1011 1213 1415 1617 1819 1A1B 1C1D 1E1F  "................"
d0000032 - 2021 2223 2425 2627 2829 2A2B 2C2D 2E2F  ".!"#$%&#38;'()*+,-./"
d0000048 - 3031 3233 3435 3637 3839 3A3B 3C3D 3E3F  "0123456789:;&#60;=&#62;?"
d0000064 - 4041 4243 4445 4647 4849 4A4B 4C4D 4E4F  ".ABCDEFGHIJKLMNO"
d0000080 - 5051 5253 5455 5657 5859 5A5B 5C5D 5E5F  "PQRSTUVWXYZ[\]^_"
d0000096 - 6061 6263 6465 6667 6869 6A6B 6C6D 6E6F  "`abcdefghijklmno"
d0000112 - 7071 7273 7475 7677 7879 7A7B 7C7D 0000  "pqrstuvwxyz.|..."
&#60;&#60;&#60; EOF &#62;&#62;&#62;
cmd -&#62; quit
All done.
rsl3pm1 (2) &#62;
......................................................................
</td></tr>
</table>
 
</PRE>



<H2> <IMG SRC="yellowball.gif"> Case study: hedit, a file dump/edit in HEX </H2>
<P>
<A NAME="IDX288"></A>
<A NAME="IDX289"></A>
<A NAME="IDX290"></A>

</P>
<P>
Let's look at a program that allows us to dump and edit binary
(and even text files) in HEX digits. The program, called <STRONG>hedit</STRONG>
is available on the WEB source page for the tutorial.

</P>
<P>
The program does:

<PRE>
 
  - read the full file in storage
  - display the first "page" worth of dump
  - wait for commands
 
</PRE>



<H3> <IMG SRC="yellowball.gif"> Some relevant code </H3>

<P>
The reading of the input file is issued with a simple call to
the <STRONG>readbuf</STRONG> method.

<PRE>
 
fid = xfile(fn)
rc = fid.readbuf()
 
</PRE>

<P>
We now can use the array:

<PRE>
 
fid.buffer
 
</PRE>

<P>
to get the byte information of the file contents.
Again, remember that:

<PRE>
 
fid.buffer.length                -- buffer's length

fid.buffer[0]                    -- BUFFER
(...)                            --
fid.buffer[fid.buffer.length-1]  --
 
</PRE>

<P>
The method <STRONG>linedis</STRONG> is used to prepare the line that needs
to be displayed.

</P>
<P>
<A NAME="IDX291"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: linedis                                             |<STRONG>78</STRONG>
| -- purpose.....: prepare a line                                      |<STRONG>79</STRONG>
| --                                                                   |<STRONG>80</STRONG>
|   method linedis(bs=rexx,buf=byte[]) public static                   |<STRONG>81</STRONG>
|     obh = ''                                                         |<STRONG>82</STRONG>
|     obc = ''                                                         |<STRONG>83</STRONG>
|                                                                      |<STRONG>84</STRONG>
|     -- this logic is not perfect, might require rewriting            |<STRONG>85</STRONG>
|     -- get 2 bytes a time, in HEX and in CHAR                        |<STRONG>86</STRONG>
|     --                                                               |<STRONG>87</STRONG>
|     loop j = 0 to 14 by 2                                            |<STRONG>88</STRONG>
|       p1 = bs*16+j                                                   |<STRONG>89</STRONG>
|       p2 = bs*16+j+1                                                 |<STRONG>90</STRONG>
|       if p1 &#62; buf.length - 1    -- past end of buffer                |<STRONG>91</STRONG>
|         then c1 = '00'          --                                   |<STRONG>92</STRONG>
|         else c1 = rexx buf[p1]                                       |<STRONG>93</STRONG>
|       if p2 &#62; buf.length - 1                                         |<STRONG>94</STRONG>
|         then c2 = '00'                                               |<STRONG>95</STRONG>
|         else c2 = rexx buf[p2]                                       |<STRONG>96</STRONG>
|       obh = obh||c1.d2x(2)||c2.d2x(2)' '                             |<STRONG>97</STRONG>
|       if c1 &#62; 32 &#38; c1 &#60; 127     -- only char we can see              |<STRONG>98</STRONG>
|         then c1 = c1.d2c()      -- please                            |<STRONG>99</STRONG>
|         else c1 = '.'                                                |<STRONG>00</STRONG>
|       if c2 &#62; 32 &#38; c2 &#60; 127     -- ditto                             |<STRONG>01</STRONG>
|         then c2 = c2.d2c()      --                                   |<STRONG>02</STRONG>
|         else c2 = '.'                                                |<STRONG>03</STRONG>
|       obc = obc||c1||c2                                              |<STRONG>04</STRONG>
|     end                                                              |<STRONG>05</STRONG>
|                                                                      |<STRONG>06</STRONG>
|     -- that's the full line                                          |<STRONG>07</STRONG>
|     --                                                               |<STRONG>08</STRONG>
|     ptr = bs*16                                                      |<STRONG>09</STRONG>
|     if dtyp = 'D'                                                    |<STRONG>10</STRONG>
|       then ptr = 'd'ptr.right(7,'0')                                 |<STRONG>11</STRONG>
|       else ptr = 'd'ptr.right(7,'0')                                 |<STRONG>12</STRONG>
|     l = ptr '-' obh '"'obc'"'                                        |<STRONG>13</STRONG>
|     return l                                                         |<STRONG>14</STRONG>
|                                                                      |<STRONG>15</STRONG>
+----------------------------------------------------------------------+
                                               hedit.nrx(Method:linedis)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/hedit.nrx">Download the complete source for the hedit.nrx library </A>
 
</PRE>

<P>
The <STRONG>change</STRONG> routine is used to perform a change over a subsequent
set of bytes. You perform a change typing:

<PRE>
 
change START byte_string
 
</PRE>

<P>
like:

<PRE>
 
change 5 CAFE000067
 
</PRE>

<P>
<A NAME="IDX292"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: change                                              |<STRONG>58</STRONG>
| -- purpose.....: change a set of bytes                               |<STRONG>59</STRONG>
| --                                                                   |<STRONG>60</STRONG>
|   method change(bs=rexx,up=rexx,buf=byte[]) public static            |<STRONG>61</STRONG>
|     -- some checks                                                   |<STRONG>62</STRONG>
|     --                                                               |<STRONG>63</STRONG>
|     if bs &#60; 0 | bs &#62; buf.length-1 then                               |<STRONG>64</STRONG>
|       do                                                             |<STRONG>65</STRONG>
|         say 'Invalid start byte.'                                    |<STRONG>66</STRONG>
|         return                                                       |<STRONG>67</STRONG>
|       end                                                            |<STRONG>68</STRONG>
|     list = up                                                        |<STRONG>69</STRONG>
|     i = bs                                                           |<STRONG>70</STRONG>
|     loop while list &#60;&#62; ''                                            |<STRONG>71</STRONG>
|       parse list nb +2 list                                          |<STRONG>72</STRONG>
|       say nb                                                         |<STRONG>73</STRONG>
|       buf[i] = nb.x2d(2)                                             |<STRONG>74</STRONG>
|       i = i+1                                                        |<STRONG>75</STRONG>
|     end                                                              |<STRONG>76</STRONG>
|                                                                      |<STRONG>77</STRONG>
+----------------------------------------------------------------------+
                                                hedit.nrx(Method:change)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/hedit.nrx">Download the complete source for the hedit.nrx library </A>
 
</PRE>

<P>
The actual saving is performed by the method <STRONG>save</STRONG>, and the
real kernel code is:

</P>

<PRE>
 
ofid = xfile(ofn)     -- define OUTPUT file
ofid.buffer = buf     -- point to buffer
rc = ofid.writebuf()  -- WRITE it!
 
</PRE>

<P>
<A NAME="IDX293"></A>

<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="88%" BGCOLOR="FFFFFF">
<tr valign=top>
<td>
<PRE>
+----------------------------------------------------------------------+
| -- method......: save                                                |<STRONG>30</STRONG>
| -- purpose.....: saves a buffer                                      |<STRONG>31</STRONG>
| --                                                                   |<STRONG>32</STRONG>
|   method save(sargs=rexx,buf=byte[]) public static                   |<STRONG>33</STRONG>
|     parse sargs ofn .                                                |<STRONG>34</STRONG>
|                                                                      |<STRONG>35</STRONG>
|     -- check if we have a filename and if it is not                  |<STRONG>36</STRONG>
|     -- already there                                                 |<STRONG>37</STRONG>
|     --                                                               |<STRONG>38</STRONG>
|     if ofn = '' then                                                 |<STRONG>39</STRONG>
|       do                                                             |<STRONG>40</STRONG>
|         say 'Missing filename.'                                      |<STRONG>41</STRONG>
|         return                                                       |<STRONG>42</STRONG>
|       end                                                            |<STRONG>43</STRONG>
|     if xfile.fexist(ofn) then                                        |<STRONG>44</STRONG>
|       do                                                             |<STRONG>45</STRONG>
|         say 'File "'ofn'" already exists. OK to overwrite?\-'        |<STRONG>46</STRONG>
|         parse ask.upper() answ                                       |<STRONG>47</STRONG>
|         if answ &#60;&#62; 'Y' then return                                   |<STRONG>48</STRONG>
|       end                                                            |<STRONG>49</STRONG>
|                                                                      |<STRONG>50</STRONG>
|     -- OK, go head                                                   |<STRONG>51</STRONG>
|     --                                                               |<STRONG>52</STRONG>
|     ofid = xfile(ofn)                                                |<STRONG>53</STRONG>
|     ofid.buffer = buf                                                |<STRONG>54</STRONG>
|     rc = ofid.writebuf()                                             |<STRONG>55</STRONG>
|     if rc = 0                                                        |<STRONG>56</STRONG>
|       then say 'Buffer written OK to "'ofn'".'                       |<STRONG>57</STRONG>
|       else say 'Problems writing "'ofn'".'                           |<STRONG>58</STRONG>
|                                                                      |<STRONG>59</STRONG>
+----------------------------------------------------------------------+
                                                  hedit.nrx(Method:save)
</td><td><img src="netrexx.gif">
</td></tr>
</table>

<IMG SRC="resource.gif"> <A href="../library/hedit.nrx">Download the complete source for the hedit.nrx library </A>
 
</PRE>



<H3> <IMG SRC="yellowball.gif"> Sample session </H3>


<PRE>
 
</PRE>
<table border cellpadding=5 cellspacing=0  width="80%" BGCOLOR="707070">
<tr><td>
<PRE>
.....................................................................
rsl3pm01 (1) &#62; java hedit rwf.out
Welcome to hedit.
d0000000 - 0001 0203 0405 0607 0809 0A0B 0C0D 0E0F  "................"
d0000016 - 1011 1213 1415 1617 1819 1A1B 1C1D 1E1F  "................"
d0000032 - 2021 2223 2425 2627 2829 2A2B 2C2D 2E2F  ".!"#$%&#38;'()*+,-./"
d0000048 - 3031 3233 3435 3637 3839 3A3B 3C3D 3E3F  "0123456789:;&#60;=&#62;?"
d0000064 - 4041 4243 4445 4647 4849 4A4B 4C4D 4E4F  ".ABCDEFGHIJKLMNO"
d0000080 - 5051 5253 5455 5657 5859 5A5B 5C5D 5E5F  "PQRSTUVWXYZ[\]^_"
d0000096 - 6061 6263 6465 6667 6869 6A6B 6C6D 6E6F  "`abcdefghijklmno"
d0000112 - 7071 7273 7475 7677 7879 7A7B 7C7D 0000  "pqrstuvwxyz.|..."
&#60;&#60;&#60; EOF &#62;&#62;&#62;

cmd -&#62;help
Available commands are:
DOWN                - move down one page.
UP                  - move up one page.
QUIT                - exit program.
VERSION             - show program version.
GO nnnn             - go to location NNNN (DECimal).
TOP                 - go to top.
SAVE fn             - save buffer as "fn".
CHANGE start hexstr - change bytes from "start" with "hexstr".

cmd -&#62;CHANGE 0 CAFEBABECAFEBABE
d0000000 - CAFE BABE CAFE BABE 0809 0A0B 0C0D 0E0F  "................"
d0000016 - 1011 1213 1415 1617 1819 1A1B 1C1D 1E1F  "................"
d0000032 - 2021 2223 2425 2627 2829 2A2B 2C2D 2E2F  ".!"#$%&#38;'()*+,-./"
d0000048 - 3031 3233 3435 3637 3839 3A3B 3C3D 3E3F  "0123456789:;&#60;=&#62;?"
d0000064 - 4041 4243 4445 4647 4849 4A4B 4C4D 4E4F  ".ABCDEFGHIJKLMNO"
d0000080 - 5051 5253 5455 5657 5859 5A5B 5C5D 5E5F  "PQRSTUVWXYZ[\]^_"
d0000096 - 6061 6263 6465 6667 6869 6A6B 6C6D 6E6F  "`abcdefghijklmno"
d0000112 - 7071 7273 7475 7677 7879 7A7B 7C7D 0000  "pqrstuvwxyz.|..."
&#60;&#60;&#60; EOF &#62;&#62;&#62;
cmd -&#62; quit

..................................................................
</td></tr>
</table>
 
</PRE>



<H2> <IMG SRC="yellowball.gif"> The rxfile package. </H2>
<P>
<A NAME="IDX294"></A>


<H3> <IMG SRC="yellowball.gif"> Availability </H3>
<P>
The <STRONG>rxfile</STRONG> package is available directly from the author,
at the following URL:

<PRE>
 
<A href="http://www.geocities.com/SiliconValley/Park/4218/RXFILE.HTML">http://www.geocities.com/SiliconValley/Park/4218/RXFILE.HTML</A>
<EM>for rxfile</EM>
and
<A href="http://www.geocities.com/SiliconValley/Park/4218/">http://www.geocities.com/SiliconValley/Park/4218/</A>
<EM>Marsiglietti's home page</EM>
 
</PRE>


<PRE>
 
<B> *** This section is: </B>
<B> <img src="underc.gif"> </B>
<B> *** and will be available in next releases</B>

</PRE>



<H2> <IMG SRC="yellowball.gif"> Summary </H2>
<P>
<EM>A resume' of what we have seen in this chapter:</EM>

<PRE>
 
 
</PRE>


<PRE>
 
<B> *** This section is: </B>
<B> <img src="underc.gif"> </B>
<B> *** and will be available in next releases</B>

</PRE>

<P>
 
<P><HR><P>
</BODY>
</HTML>
<PRE>
File: nr_13.html.
</PRE>
<HR>
<FONT SIZE=-1 COLOR="4D4DFF">
The contents of this WEB page are Copyright &copy 1997 by Pierantonio Marchesini / ETH Zurich.<P>
Last update was done on 18 May 1998 21:47:48(GMT +2).
</FONT>

